eSoafApp.controller("MenuBarController",["$rootScope","$scope","$http","$cookies","socketService","sysInfoService","$timeout","withLazyModule","$q","getParameter",function(e,n,t,r,a,M,E,I,i,o){function u(t){M.$currentTxn=t.txnId,document.oncontextmenu=Function("return false "),document.ondragstart=Function("return false "),document.onselectstart=Function("return false ");var r=!1;M.getAuthorities()&&M.getAuthorities().MODULEID[M.$currentModule].ITEMID[M.$currentTxn]&&M.getAuthorities().MODULEID[M.$currentModule].ITEMID[M.$currentTxn].FUNCTIONID.screen&&(r=!0);var a=!1;$(document).on("keydown",function(e){(17==e.keyCode||91==e.keyCode)&&(a=!0)}).on("keyup",function(e){(17==e.keyCode||91==e.keyCode)&&(a=!1)}),$(document).on("keydown",function(e){if(a&&67==e.keyCode){var n=document.createElement("input");n.setAttribute("value",""),document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}).on("keyup",function(e){if(r&&44==e.keyCode){var n=document.createElement("input");n.setAttribute("value",""),document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}),document.getElementById("watermark").className="hidden",M.getAuthorities()&&M.getAuthorities().MODULEID[M.$currentModule].ITEMID[M.$currentTxn]&&M.getAuthorities().MODULEID[M.$currentModule].ITEMID[M.$currentTxn].FUNCTIONID.watermark&&(document.getElementById("watermark").className="watermark"),"HOME"!=t.txnId?n.txnPath=t.txnPath:n.txnPath=void 0,e.menuItemInfo={url:"",txnId:t.txnId,txnName:t.txnName},E(function(){e.menuItemInfo={url:"assets/txn/"+t.txnId+"/"+t.txnId+".html",txnId:t.txnId,txnName:t.txnName,txnPath:n.txnPath}}).then(function(){n.menuNon()})}n.priID=M.getPriID()[0],n.UserName=M.getUserName(),n.RoleName=M.getRoleName(),n.BranchName=M.getAvailBranch().length>1?"":"null"==M.getBranchName()?"":"004AO"==n.priID?"":M.getBranchName(),n.isLocal=M.Exclude.IP.indexOf(document.location.hostname)>-1,e.GENERATE_MENU=function(){e.MenuBar=angular.copy(M.getMenu());var t,r="mobile"==M.getLoginSourceToken(),a=M.getPriID()[0];(t=i.defer(),n.sendRecv("CMMGR020","getMobileAUTH","com.systex.jbranch.app.server.fps.cmmgr020.CMMGR020ItemVO",{},function(e,n){n||t.resolve(e[0].body.data)}),t.promise).then(function(n){!function e(n,t){for(var E=n.length-1;E>=0;E--)"P"==n[E].MENU_TYPE?M.getAuthorities().MODULEID[M.$currentModule].ITEMID[n[E].MENU_ID]?r&&-1==_.findIndex(t,function(e){return e.ITEMID==n[E].MENU_ID&&e.PRIVILEGEID==a})&&n.splice(E,1):n.splice(E,1):n[E].SUBITEM&&(e(n[E].SUBITEM,t),0==n[E].SUBITEM.length&&n.splice(E,1))}(e.MenuBar,n)}),n.sendRecv("CRM911","initial","com.systex.jbranch.app.server.fps.crm911.CRM911InputVO",{emp_id:M.getUserID()},function(n,t){if(!t){var r=[];angular.forEach(n[0].body.resultList,function(e){r.push({MENU_ID:e.LINK_URL,MENU_NAME:e.LINK_NAME,MENU_TYPE:"U"})}),e.MenuBar.push({MENU_ID:"TEST",MENU_NAME:"常用連結",MENU_TYPE:"F",SEQ_NUM:7,SUBITEM:[{MENU_ID:"TEST",MENU_NAME:"常用連結",MENU_TYPE:"F",SEQ_NUM:1,SUBITEM:r}]})}})},n.menuVisible=function(e,n){document.getElementsByClassName("menuBar")[n].style.opacity=e?"1":"0",document.getElementsByClassName("menuBar")[n].style.visibility=e?"visible":"hidden"},n.menuNon=function(){$(".menuBar").each(function(e){$(this).css("visibility","hidden")})},n.GeneratePage=function(e){e.txnId=e.txnId.toUpperCase().trim(),"HOME"==e.txnId?u(e):"CRM351"==e.txnId?n.sendRecv("CRM351","check","com.systex.jbranch.app.server.fps.crm351.CRM351InputVO",{pri_id:M.getPriID()[0]},function(t,r){if(!r){if(0==t[0].body.checkList.length){n.showMsg("組織人員管理功能中有註記離職、異動分行、留停者，才會開放此交接功能");return}I("assets/txn/"+e.txnId+"/"+e.txnId,function(){u(e)},function(e){n.showErrorMsg(e)})}}):I("assets/txn/"+e.txnId+"/"+e.txnId,function(){u(e)},function(e){n.showErrorMsg(e)})},n.customEnter=function(e){e=e.toUpperCase(),n.GeneratePage({txnName:e,txnId:e,txnPath:[]})},e.MenuBarLink=function(t,r){var a=e.menuItemInfo.txnPath;switch(r){case 0:n.GeneratePage({txnName:"HOME",txnId:"HOME",txnPath:[{MENU_ID:"HOME",MENU_NAME:"首頁"}]});break;case 1:for(var M=0;M<e.MenuBar.length;M+=1){if(e.MenuBar[M].MENU_ID==t.MENU_ID&&"P"==e.MenuBar[M].MENU_TYPE){var E=a.map(function(e){return e.MENU_ID}).indexOf(t.MENU_ID);a.splice(-1,a.length-1-E),n.GeneratePage({txnName:e.MenuBar[M].MENU_NAME,txnId:e.MenuBar[M].MENU_ID,txnPath:a});break}if("F"==e.MenuBar[M].MENU_TYPE)for(var I=0;I<e.MenuBar[M].SUBITEM.length;I+=1){if(e.MenuBar[M].SUBITEM[I].MENU_ID==t.MENU_ID&&"P"==e.MenuBar[M].SUBITEM[I].MENU_TYPE){var E=a.map(function(e){return e.MENU_ID}).indexOf(t.MENU_ID);a.splice(-1,a.length-1-E),n.GeneratePage({txnName:e.MenuBar[M].SUBITEM[I].MENU_NAME,txnId:e.MenuBar[M].SUBITEM[I].MENU_ID,txnPath:a});break}if("F"==e.MenuBar[M].SUBITEM[I].MENU_TYPE)for(var i=0;i<e.MenuBar[M].SUBITEM[I].SUBITEM.length;i+=1){if(e.MenuBar[M].SUBITEM[I].SUBITEM[i].MENU_ID==t.MENU_ID&&"P"==e.MenuBar[M].SUBITEM[I].SUBITEM[i].MENU_TYPE){var E=a.map(function(e){return e.MENU_ID}).indexOf(t.MENU_ID);a.splice(-1,a.length-1-E),n.GeneratePage({txnName:e.MenuBar[M].SUBITEM[I].SUBITEM[i].MENU_NAME,txnId:e.MenuBar[M].SUBITEM[I].SUBITEM[i].MENU_ID,txnPath:a});break}if("F"==e.MenuBar[M].SUBITEM[I].SUBITEM[i].MENU_TYPE){for(var o=0;o<e.MenuBar[M].SUBITEM[I].SUBITEM[i].SUBITEM.length;o+=1)if(e.MenuBar[M].SUBITEM[I].SUBITEM[i].SUBITEM[o].MENU_ID==t.MENU_ID&&"P"==e.MenuBar[M].SUBITEM[I].SUBITEM[i].SUBITEM[o].MENU_TYPE){var E=a.map(function(e){return e.MENU_ID}).indexOf(t.MENU_ID);a.splice(-1,a.length-1-E),e.GeneratePage({txnName:e.MenuBar[M].SUBITEM[I].SUBITEM[i].SUBITEM[o].MENU_NAME,txnId:e.MenuBar[M].SUBITEM[I].SUBITEM[i].SUBITEM[o].MENU_ID,txnPath:a});break}}}}}}},e.GENERATE_MENU(),function n(){if(e.ApplicationID=M.getApplicationID(),e.BranchID=M.getBranchID(),e.WsID=M.getWsID(),void 0==M.getUserID()){alert("無法取得使用者帳號");return}e.TlrID=M.getUserID(),u({txnName:"首頁",txnId:"HOME",txnPath:[{MENU_ID:"HOME",MENU_NAME:"首頁"}]})}(),e.GeneratePage=n.GeneratePage}]);