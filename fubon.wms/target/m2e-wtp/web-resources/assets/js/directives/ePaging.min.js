/**================================================================================================
@program: ePaging.js
@description: 
@version: 1.0.20170313
=================================================================================================*/
eSoafApp.directive("ePaging",["projInfoService",function(t){return{restrict:"E",replace:!0,scope:{outputVO:"=outputvo",inputVO:"=?inputvo",displayLimit:"=displaylimit",rowCountLimit:"=?rowcountlimit",callQuery:"&?callquery",mode:"=?",dataList:"=?datalist",page:"@?"},template:function(t,a){var e='<div class="pagingRow">    <span ng-if="mode == 1 && dataList.length > 0">	    1 - {{dataList.length}}&nbsp;&nbsp;&nbsp;&nbsp;共{{outputVO.totalRecord | number}}筆資料	    <span ng-if="displayLimit < outputVO.totalRecord">	    [<a href="/next/row/{{rowCountLimit}}" onclick="return false" ng-click="pagingAppend(rowCountLimit)">       顯示下{{outputVO.totalRecord - displayLimit > rowCountLimit ? rowCountLimit : outputVO.totalRecord - displayLimit}}筆資料</a>]	    </span>    </span>    <ul class="pagination" ng-if="mode == 2 && dataList.length > 0">       <li><a href="page/1" onclick="return false" ng-click="changePage(0)">&laquo;</a></li>       <li><a href="/page/{{outputVO.currentPageIndex == 0 ? 1 : outputVO.currentPageIndex}}" onclick="return false" ng-click="changePage(outputVO.currentPageIndex == 0 ? 0 : outputVO.currentPageIndex - 1)">&lsaquo;</a></li>       <li ng-repeat="row in resultArray" class="{{row.clazz}}"><a href="/page/{{row.text + 1}}" onclick="return false" ng-click="changePage(row.text)">{{row.text + 1}}</a></li>       <li><a href="/page/{{outputVO.currentPageIndex == outputVO.totalPage - 1 ? outputVO.totalPage : outputVO.currentPageIndex + 2}}" onclick="return false" ng-click="changePage(outputVO.currentPageIndex == outputVO.totalPage - 1 ? outputVO.totalPage - 1 : outputVO.currentPageIndex + 1)">&rsaquo;</a></li>		<li><a href="page/{{outputVO.totalPage}}" onclick="return false" ng-click="changePage(outputVO.totalPage - 1)">&raquo;</a></li>		<span style="padding-left:20px;position: relative;top: 10px;" ng-if="mode == 2 && outputVO.totalRecord > 0">		{{1 + (rowCountLimit * outputVO.currentPageIndex)}} - {{dataList.length + (rowCountLimit * outputVO.currentPageIndex)}}&nbsp;&nbsp;&nbsp;&nbsp;共{{outputVO.totalRecord}}筆		</span>    </ul>    <span ng-if="mode == 3 && dataList.length > 0">	    1 - {{displayLimit < dataList.length ? displayLimit : dataList.length}}&nbsp;&nbsp;&nbsp;&nbsp;共{{dataList.length}}筆資料	    <span ng-if="displayLimit < dataList.length">	    [<a href="/next/row/{{rowCountLimit}}" onclick="return false" ng-click="pagingAppend(rowCountLimit)">       顯示下{{dataList.length - displayLimit > rowCountLimit ? rowCountLimit : dataList.length - displayLimit}}筆資料</a>]	    </span>    </span></div>';return e},controller:["$scope",function(t){t.outputVO=t.outputVO||{}}],link:function(a,e,i,n){a.requestRowCountLimit=t.$paging.rowCountLimit,0==angular.isDefined(i.callquery)&&(a.requestRowCountLimit=0),console.log("scope.requestRowCountLimit="+a.requestRowCountLimit),a.rowCountLimit=t.$paging.rowCountLimit,a.displayLimit=a.displayLimit||a.rowCountLimit,a.mode=a.mode||1,t.$paging.mode=a.mode,console.log("ePaging.mode="+t.$paging.mode),a.pagingAppend=function(t){console.log("displayLimit="+a.displayLimit+",appendRow="+t),a.displayLimit+=t,angular.isDefined(i.callquery)&&(a.inputVO.pageCount=a.rowCountLimit,a.inputVO.currentPageIndex=a.outputVO.currentPageIndex+1,a.callQuery())},a.changePage=function(t){a.displayLimit>0&&(a.displayLimit=-1*a.displayLimit),angular.isDefined(i.callquery)&&(a.inputVO.pageCount=a.rowCountLimit,a.inputVO.currentPageIndex=t,a.callQuery())},a.$watch("outputVO",function(t,e){if(t!=e){a.page=a.page-0||4;var i=0;a.resultArray=[];var n=a.outputVO.currentPageIndex,o=a.outputVO.totalPage;if(2*a.page+1>o)for(var u=0;o>u;u++){var r={};r.clazz="",n==u&&(r.clazz="active"),r.text=u,a.resultArray.push(r)}else{for(var u=-a.page;u<=a.page;u++){var r={};r.clazz="",0==u&&(r.clazz="active"),0>n+u?i++:n+u>o-1?i--:(r.text=n+u,a.resultArray.push(r))}for(var u=1;u<=Math.abs(i);u++){var r={};r.clazz="",i>0?(r.text=n+a.page+u,a.resultArray.push(r)):(r.text=n-a.page-u,a.resultArray.splice(0,0,r))}}}})}}}]);