eSoafApp.directive("eSorter",["socketService","$q","$timeout","$rootScope","sysInfoService",function(e,t,a,c,r){return{restrict:"E",transclude:!0,scope:{eConnect:"@?",eMode:"@?",eInput:"=?",eOutput:"=?",eCol:"@?",eQuery:"&?",eDisabled:"=?",eHide:"=?"},template:function(e,t){return'<div>\t<button id="eSorter_show" type="button" data-toggle="tooltip" style="text-shadow: 1px 1px 0 rgba(42,45,50,0.5);cursor:pointer!important;-webkit-cursor:pointer!important;margin:0!important;background:transparent!important;border:0px!important;vertical-align:middle!important;text-align:center!important;" ng-click="checker();sorting();">\t\t<label style="cursor:pointer;-webkit-cursor:pointer;vertical-align:middle!important;margin:0!important;text-align:center!important;font-weight:500!important" ng-transclude></label>\t\t<i id="eSorter_flag" style="cursor:pointer;-webkit-cursor:pointer;margin:0!important;top:2px!important;line-height:none!important;" ng-class="{\'glyphicon glyphicon-sort-by-attributes\':flag,\'glyphicon glyphicon-sort-by-attributes-alt\':!flag}"></i>\t</button>\t<label id="eSorter_hide" data-toggle="tooltip" class="eSorter-disabled" style="vertical-align:middle!important;margin:0!important;text-align:center!important;font-weight:500!important" ng-transclude></label><i id="eSorter_disabledIcon" class="glyphicon glyphicon-ban-circle" style="color:#ff0000;opacity:0.3!important;font-size:12px;pointer-events:none;"></i></div>'},link:function(o,s,e,t,r){angular.isDefined(o.eMode)?"auto"!==o.eMode.trim().toLowerCase()&&(o.eMode=o.eMode.trim().toLowerCase()):e.$set("eMode","auto"),o.flag=!0,o.status=!1,o.eSwitch=!1;var n=-1;if(o.eDisabled?($(s).find("#eSorter_show:first").css("color","#F9F9F9").css("text-shadow","none").attr("disabled",!0).attr("title","排序功能限制使用。").tooltip(),$(s).find("#eSorter_disabledIcon:first").css("display","initial")):($(s).find("#eSorter_show:first").css("color","#FFFFFF").css("text-shadow","1px 1px 0 rgba(42,45,50,0.5)").prop("disabled",!1),$(s).find("#eSorter_disabledIcon:first").css("display","none")),o.eHide?($(s).find("#eSorter_show:first").css("display","none"),$(s).find("#eSorter_hide:first").css("display","initial")):($(s).find("#eSorter_show:first").css("display","initial"),$(s).find("#eSorter_hide:first").css("display","none")),o.$parent.$sorter){if(-1!==o.$parent.$sorter.conn.indexOf(o.eConnect)){for(var i=0;i<o.$parent.$sorter.conn.length;i++)o.$parent.$sorter.conn[i]===o.eConnect&&(n+=1);n+=1}else n=0;o.$parent.$sorter.conn.push(o.eConnect),o.$parent.$sorter.num.push(n),o.$parent.$sorter.chkidx.push(o.eConnect+String(n)),o.$parent.$sorter.chkpass.push(!1)}else n=0,o.$parent.$sorter={conn:[o.eConnect],num:[n],chkidx:[o.eConnect+String(n)],chkpass:[!1]};s.find("#eSorter_show:first").on("mouseenter",function(){s.find("#eSorter_show:first").attr("title","滑鼠點擊進行"+(o.flag?"降冪":"升冪")+"排序。").tooltip(),!0!==$(s).find("#eSorter_show").hasClass("eSorter-main-desc")&&o.flag}).on("mouseleave",function(){s.find("#eSorter_show:first").attr("title","滑鼠點擊進行"+(o.flag?"降冪":"升冪")+"排序。").tooltip(),!0!==$(s).find("#eSorter_show").hasClass("eSorter-main-desc")&&o.flag}),s.find("#eSorter_show:first").on("mouseup",function(){s.find("#eSorter_show:first").attr("title","滑鼠點擊進行"+(o.flag?"降冪":"升冪")+"排序。").tooltip()}),o.sorting=function(){if(!0===o.flag){if(-1!==o.$parent.$sorter.conn.indexOf(o.eConnect))for(var e=0;e<o.$parent.$sorter.conn.length;e++)o.$parent.$sorter.conn[e]===o.eConnect&&o.$parent.$sorter.num[e]!==n&&(o.$parent.$sorter.chkpass[e]=!0);s.find("#eSorter_show:first").removeClass("eSorter-main").addClass("eSorter eSorter-main-desc"),o.status=!1,o.flag=!1}else s.find("#eSorter_show:first").removeClass("eSorter-main-desc").addClass("eSorter eSorter-main"),o.status=!0,o.flag=!0;a(function(){s.find("#eSorter_show").trigger("blur")},500);var t=$("e-jumping[e-connect="+o.eConnect+']:not([style*="display:none"]) option[selected=selected]').attr("label")-1;"auto"===o.eMode?(t&&0<=t&&(o.eInput.currentPageIndex=t),o.eInput.asc=o.flag,o.eInput.column=o.eCol.trim(),o.eQuery()):angular.isDefined(o.eInput)&&angular.isDefined(o.eCol)&&angular.isDefined(o.eQuery)&&(o.eInput.asc=o.flag,o.eInput.column=o.eCol.trim(),t&&0<=t&&(o.eInput.currentPageIndex=t),o.eQuery())},o.checker=function(){o.eSwitch=!0},o.$watch("eDisabled",function(){o.eDisabled?($(s).find("#eSorter_show:first").css("color","#f9f9f9").css("text-shadow","none").attr("disabled",!0).attr("title","排序功能限制使用。").tooltip(),$(s).find("#eSorter_disabledIcon:first").css("display","initial")):($(s).find("#eSorter_show:first").css("color","#FFFFFF").css("text-shadow","1px 1px 0 rgba(42,45,50,0.5)").prop("disabled",!1),$(s).find("#eSorter_disabledIcon:first").css("display","none"))}),o.$watch("eHide",function(){o.eHide?($(s).find("#eSorter_show:first").css("display","none"),$(s).find("#eSorter_hide:first").css("display","initial")):($(s).find("#eSorter_show:first").css("display","initial"),$(s).find("#eSorter_hide:first").css("display","none"))}),o.$watch("flag",function(){!0===o.flag?!0===o.status?(s.find("#eSorter_show:first").css("text-shadow","0 0 6px #FFFFFF").css("color","#0000FF").removeClass("eSorter-main-desc"),!1===s.find("#eSorter_show:first").hasClass("eSorter-main")&&s.find("#eSorter_show:first").addClass("eSorter-main")):s.find("#eSorter_show:first").css("text-shadow","1px 1px 0 rgba(42,45,50,0.5)").css("color","#FFFFFF").removeClass("eSorter-main eSorter-main-desc"):(s.find("#eSorter_show:first").css("text-shadow","0 0 6px #FFFFFF").css("color","#FF0000").removeClass("eSorter-main"),!1===s.find("#eSorter_show:first").hasClass("eSorter-main-desc")&&s.find("#eSorter_show:first").addClass("eSorter-main-desc"))}),o.$parent.$watch("$sorter.chkpass["+o.$parent.$sorter.chkidx.indexOf(o.eConnect+String(n))+"]",function(){!0===o.$parent.$sorter.chkpass[o.$parent.$sorter.chkidx.indexOf(o.eConnect+String(n))]&&(o.status=!1,o.flag=!0,o.$parent.$sorter.chkpass[o.$parent.$sorter.chkidx.indexOf(o.eConnect+String(n))]=!1,s.find("#eSorter_show:first").css("text-shadow","1px 1px 0 rgba(42,45,50,0.5)").css("color","#FFFFFF").removeClass("eSorter-main eSorter-main-desc"))}),o.$watch("eOutput",function(e,t){var r=!1;!1===o.eSwitch?r||(o.status=!1,o.flag=!0,s.find("#eSorter_show").css("text-shadow","1px 1px 0 rgba(42,45,50,0.5)").css("color","#FFFFFF").removeClass("eSorter-main eSorter-main-desc")):(r=!0,o.eSwitch=!1)}),c.$on(o.eConnect,function(e,t){!1===o.eSwitch&&(o.eSwitch=!0)})}}}]);