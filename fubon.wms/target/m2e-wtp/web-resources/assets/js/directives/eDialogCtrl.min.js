eSoafApp.directive("modalHeader",["sysInfoService","$rootScope","ngDialog","$timeout",function(u,p,g,v){return{restrict:"C",scope:{},controller:"BaseController",link:function(t,o,e){if(-1!=u.Exclude.title.indexOf($(o).children().text())||-1!=u.Exclude.controller.indexOf(p.localCtrl))return $(o).parent().parent("[class*=modal-dialog]:first").find(".modal-content:first").css("overflow","hidden"),void $(o).parent().parent("[class*=modal-dialog]:first").find(".modal-content:first").css("height","auto");if(-1<e.class.indexOf("esoaf-confirm"))return $(o).parent().parent("[class*=modal-dialog]:first").find(".modal-content:first").css("overflow","hidden"),void $(o).parent().parent("[class*=modal-dialog]:first").find(".modal-content:first").css("height","auto");var n,i,l,s,c,a,r,d=["#"+g.latestID,$(o).parent().parent("[class*=modal-dialog]:first"),$(o)],f=!1,m=(u.getNavigator(),{width:"",height:"","max-width":"","max-height":"",margin:"",position:"",top:"",right:"",bottom:"",left:""});function h(){v(function(){var t=p.$counter.visit||!1;if(t){for(var o=0;o<t.length;o+=1)if(t[o].element==d[1])return;t.push({name:d[2].find("h4").text(),element:d[1]})}else t=[{name:d[2].find("h4").text(),element:d[1]}];p.$counter.visit=t},500)}!function(t,o,e,n){if(0<t.$counter.total.length){for(var i=0;i<t.$counter.total.length;i+=1)if(t.$counter.total[i].element==o[1]){e=i;break}e?t.$counter.total.splice(e,1,{id:n,element:o[1],title:o[2].find("h4").text()}):t.$counter.total.push({id:n,element:o[1],title:o[2].find("h4").text()})}else t.$counter.total.push({id:n,element:o[1],title:o[2].find("h4").text()})}(p,d,!1,g.latestID),n=d,(n=$(n[2])||!1)&&n.find(".close").after("<button class='zoom-in'><i class='glyphicon glyphicon-minus'></i></button>").after("<button class='zoom-out'><i class='glyphicon glyphicon-unchecked'></i></button>"),c=!1,(i=d)[2].css("cursor","pointer"),i[2].on("mousedown",function(t){c=!0,l=t.pageX-parseInt($(i[1]).css("left")),s=t.pageY-parseInt($(i[1]).css("top")),i[2].css("cursor","move")}),$(document).on("mousemove",function(t){var o;c&&(o=t.pageX-l,t=t.pageY-s,$(i[1]).css({top:t,left:o}))}).on("mouseup",function(){c=!1,i[2].css("cursor","pointer")}),$("body").on("mouseleave",function(t){$(document).trigger("mouseup")}),a=d,type(a[1].attr("resizable"))&&!1===a[1].find(".modal-content:first>*").hasClass(".esoaf-confirm")&&a[1].find(".modal-content:first").resizable({minWidth:200,minHeight:200}),a[2].not(".zoom-in").not(".zoom-out").on("dblclick",function(){a[1].hide(500,h())}),a[2].attr("data-toggle","tooltip").attr("title","雙擊滑鼠隱藏或展開彈跳視窗").tooltip({position:{at:"center top+52"}}),r=d,$(r[1]).on("click",function(){$(".ngdialog").css("z-index","589"),$(r[0]).css("z-index","590")}),d[1].css("max-width",$("html").width()-1),d[1].on("remove",function(){f||(f=!0,function(t,o){for(var e=0;e<t.$counter.total.length;e+=1)if(t.$counter.total[e].element==o[1]){t.$counter.total.splice(e,1);break}for(e=0;e<t.$counter.visit.length;e+=1)if(t.$counter.visit[e].element==o[1]){t.$counter.visit.splice(e,1);break}}(p,d))}),o.find(".close").on("click",function(){$(d[1]).length&&$(d[0]).remove()}),o.find(".zoom-in").on("click",function(){d[1].hide(500,h())}),o.find(".zoom-out").on("click",function(){m.width=m.width||d[1].width(),m["max-width"]=m["max-width"]||d[1].css("max-width"),m.margin=m.margin||d[1].css("margin"),m.top=m.top||d[1].css("top"),m.right=m.right||d[1].css("right"),m.bottom=m.bottom||d[1].css("bottom"),m.left=m.left||d[1].css("left"),!0===o.find(".zoom-out>i").hasClass("glyphicon glyphicon-unchecked")?(d[1].css({width:"100%",margin:"auto","margin-top":"10px","max-width":"none",top:"0",right:"0",bottom:"0",left:"0"}),o.find(".zoom-out>i").removeClass("glyphicon glyphicon-unchecked").addClass("glyphicon glyphicon-modal-window")):(d[1].css({width:m.width,margin:m.margin,"max-width":m["max-width"],top:m.top,right:m.right,bottom:m.bottom,left:m.left}),o.find(".zoom-out>i").removeClass("glyphicon glyphicon-modal-window").addClass("glyphicon glyphicon-unchecked"))})}}}]);