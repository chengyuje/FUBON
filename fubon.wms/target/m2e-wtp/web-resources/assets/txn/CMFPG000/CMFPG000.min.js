"use strict";eSoafApp.config(["$locationProvider",function(e){e.html5Mode(!0)}]),eSoafApp.controller("CMFPG000Controller",["$rootScope","$scope","$location","sysInfoService","projInfoService","$controller","ngDialog","$cookies","$q","$window","$timeout","getParameter","$filter",function(e,r,o,t,n,s,i,a,$,l,c,g,p){var I,h;function u(){var e={authuid:r.authuid,iptAppUsername:r.loginID,iptAppUserPassword:r.loginCD,iptRACFUser_ID:"888803",iptRACF_Password:"",ddlBranchNo:r.branchModel,kickOut:!0};r.sendRecv("CMFPG000","authenticate","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",e,function(e,o){if(console.log("000-tlron tota="+e+", isError="+o),o)r.msgData=e.body.msgData,r.needCaptcha&&r.clearCaptcha();else{let s=e[0].body.tempUserInfo;if(t.setTempUserInfo(s),e[0].body.loginMsg&&r.showWarningMsg(e[0].body.loginMsg),t.setCurrentUserId(r.loginID),1===e[0].body.userList.length)t.setUserList(e[0].body.userList),r.sendRecv("CMFPG000","tlron","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{iptAppUsername:e[0].body.userList[0].EMP_ID,iptAppUserRole:e[0].body.userList[0].ROLE_ID,iptAppUserDeptID:e[0].body.userList[0].DEPT_ID,iptAppUserRegioinCenterID:e[0].body.userList[0].REGION_CENTER_ID,iptAppUserRegioinCenterName:e[0].body.userList[0].REGION_CENTER_NAME,iptAppUserBranchAreaID:e[0].body.userList[0].BRANCH_AREA_ID,iptAppUserBranchAreaName:e[0].body.userList[0].BRANCH_AREA_NAME,iptAppUserBranchID:e[0].body.userList[0].BRANCH_NBR,iptAppUserBranchName:e[0].body.userList[0].BRANCH_NAME,iptAppUserIsPrimaryRole:e[0].body.userList[0].IS_PRIMARY_ROLE,loginSourceToken:r.loginSourceToken,currentUserId:r.loginID},function(e,o){console.log("000-1-tlron tota="+e+", isError="+o),o?(r.msgData=e.body.msgData,r.needCaptcha&&r.clearCaptcha()):r.setSysInfoService(e[0].body)});else{if(!(e[0].body.userList.length>1))return;var a=r.loginSourceToken;r.loginID,t.setUserList(e[0].body.userList),i.open({template:"assets/txn/CMFPG000/CMFPG000_AGENT.html",className:"CMFPG000",showClose:!1,controller:["$scope",function(r){r.userList=e[0].body.userList,r.loginSourceToken=a}]}).closePromise.then(function(e){"successful"===e.value&&r.setSysInfoService(n.LoginInfo)})}}})}function f(){var e=l.navigator.language||l.navigator.userLanguage;e=e.toLocaleLowerCase();var o,n,s,i=null;return"en"===e?i={pf_sessionmanager_error_001:"workstation timeout",pf_sessionmanager_error_002:"login dupicate",pf_sessionmanager_error_003:"system error",pf_sessionmanager_error_004:"Server shutdown logout",pf_sessionmanager_error_005:"workstaion logout",pf_sessionmanager_error_006:"Business day changed",pf_sessionmanager_error_007:"please login",ehl_01_cmfpg000_008:"connect failed:{0}-{1}"}:"zh-tw"===e&&(i={pf_sessionmanager_error_001:"工作站逾時",pf_sessionmanager_error_002:"重複登入",pf_sessionmanager_error_003:"系統異常",pf_sessionmanager_error_004:"Server關機登出",pf_sessionmanager_error_005:"工作站已登出",pf_sessionmanager_error_006:"營業日期已被改變",pf_sessionmanager_error_007:"請重新登入",ehl_01_cmfpg000_008:"連線失敗:{0}-{1}"}),o=e,n=i,s=$.defer(),r.sendRecv("I18N","inquireAll","com.systex.jbranch.app.server.fps.i18n.I18NInputVO",{locale:o},function(e,o){o&&(r.showErrorMsg(e[0].body.msgData),s.reject(n)),e.length>0&&(angular.forEach(e[0].body.resultList,function(e,r,o){n[e.CODE]=e.TEXT}),t.setI18N(n),s.resolve(t.getI18N()))}),s.promise}function d(e,r,o){if(r["LEVEL"+o+"_MENU_ID"]&&!(o>5)){for(var t={},n=!1,s=0;s<e.length;s++)if(r["LEVEL"+o+"_MENU_ID"]==e[s].MENU_ID){n=!0;break}if(!n){if(t.MENU_ID=r["LEVEL"+o+"_MENU_ID"],t.MENU_NAME=r["LEVEL"+o+"_MENU_NAME"],t.MENU_TYPE=r["LEVEL"+o+"_MENU_TYPE"],t.SEQ_NUM=r["LEVEL"+o+"_SEQ_NUM"],"P"==r["LEVEL"+o+"_MENU_TYPE"]){t.ITEM_ID=r["LEVEL"+o+"_ITEM_ID"],e.push(t);return}t.SUBITEM=[],e.push(t),d(t.SUBITEM,r,o+1);return}d(e.slice(-1).pop().SUBITEM,r,o+1)}}s("BaseController",{$scope:r}),r.controllerName="CMFPG000Controller",r.initData=function(){r.authuid="",r.loginID="",r.loginCD="",r.wsId="00",r.branchModel="0000",r.mask=!1,r.IPCheck=!0,r.caCode="";var e=window.location.href;if(!(e.indexOf("MobilePlatform.html")>=0)){var o=new URL(e).searchParams.get("isMobile");o?sessionStorage.CMFPG000_MOBILE_LOGIN=o:sessionStorage.removeItem("CMFPG000_MOBILE_LOGIN")}},r.initData(),r.checkIP=function(){r.sendRecv("CMFPG000","precheckIP","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{},function(e,o){o||(e[0].body?r.IPCheck=!0:(r.IPCheck=!1,r.showMsg("不允許Internet連線")))})},sessionStorage.CMFPG000_MOBILE_LOGIN?r.loginSourceToken="mobile":o.search().isMobile&&"mobile"==o.search().isMobile&&(r.loginSourceToken="mobile",sessionStorage.CMFPG000_MOBILE_LOGIN="mobile"),r.captcha={code:"",rand(){var e="1234567890".split("");this.code="";for(var r=0;r<4;r++)this.code+=e[Math.floor(Math.random()*e.length)];return this.code},lineX:()=>Math.floor(100*Math.random()),lineY:()=>Math.floor(50*Math.random()),generate(){var e=document.getElementById("loginCaptcha"),r=e.getContext("2d");e.height=e.height;for(var o=0;o<20;o++)r.strokeStyle="rgb(119, 185, 221)",r.beginPath(),r.moveTo(this.lineX(),this.lineY()),r.lineTo(this.lineX(),this.lineY()),r.lineWidth=.5,r.closePath(),r.stroke();r.fillStyle="rgb(45, 122, 168)",r.font="italic 18px Arial",r.fillText(this.rand(),20,25)},init(){this.generate(),document.getElementById("reCaptcha").onclick=e=>{e.preventDefault(),this.generate()}},isValid(e){return this.code==e}},document.getElementById("loginCaptcha")&&document.getElementById("reCaptcha")&&r.sendRecv("CMFPG000","needCaptcha","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{},e=>{r.needCaptcha=e[0].body,r.needCaptcha&&r.captcha.init()}),document.getElementById("needCheckIP")&&r.checkIP(),r.clearCaptcha=function(){r.captcha.generate(),r.caCode=""},r.blurThenTlron=function(e){13==e.keyCode&&(e.target.blur(),r.tlron())},r.wson=function(){for(var e=window.location.search.substring(1).split("&"),o=0;o<e.length;o++){var t=e[o].split("=");"authuid"==t[0]&&(r.authuid=t[1])}r.authuid&&(console.log("query: "+window.location.search),u())},r.tlron=function(){if(r.needCaptcha&&!r.captcha.isValid(r.caCode)){r.showErrorMsg("驗證碼錯誤 !"),r.clearCaptcha();return}r.Show=!0,e.TlrID=r.loginID,e.BranchID=r.branchModel,e.WsId=r.wsId,u()},r.setSysInfoService=function(e){var o,n,s,i;console.log("20200525"+JSON.stringify(e)),a.branchId=e.loginBrh,a.UserId=e.loginID,t.setApServerName(e.apServerName),t.setUserID(e.loginID),t.setUserName(e.loginName),t.setApplicationID(r.ApplicationID),t.setBranchID(e.loginBrh),t.setAreaID(e.loginArea),t.setRegionID(e.loginRegion),t.setBranchName(e.loginBrhName),t.setWsID(r.wsId),t.setRoleID(e.loginRole),t.setPriID(e.priID),t.setRoleName(e.loginRoleName),t.setAvailBranch(e.availBranchList),t.setAvailRegion(e.availRegionList),t.setAvailArea(e.availAreaList),t.setUser(e.userInfo),t.setAoCode(e.userInfo.AoCode),t.setLoginSourceToken(e.loginSourceToken),t.setMemLoginFlag(e.memLoginFlag),r.UserID=t.getUserID(),r.ApplicationID=t.getApplicationID(),r.BranchID=t.getBranchID(),r.WsID=t.getWsID(),r.RoleID=t.getRoleID(),$.all([(o=$.defer(),r.sendRecv("CMMGR020","getMENUTree","com.systex.jbranch.app.server.fps.cmmgr020.CMMGR020DataVO",{},function(e,n){n&&(r.showErrorMsg(e[0].body.msgData),o.reject()),e.length>0&&(t.setMenu(function e(r){for(var o=[],t=0;t<r.length;t++)d(o,r[t],1);return o}(e[0].body.meunTreeLS)),o.resolve(t.getMenu()))}),o.promise).then(function(e){r.finMenu=!0}),(n=t.getRoleID(),s=$.defer(),n&&(n=n.split(","),r.sendRecv("CMFPG000","getAuthorities","com.systex.jbranch.app.server.fps.cmfpg000.AuthoritiesInputVO",{roles:n},function(e,o){var n,i;o&&(r.showErrorMsg(e[0].body.msgData),s.reject()),e.length>0&&(t.setAuthorities((n=e[0].body.authorities,i={},i.MODULEID={},angular.forEach(n,function(e,r,o){i.MODULEID[e.MODULEID]={},i.MODULEID[e.MODULEID].ITEMID={}}),angular.forEach(n,function(e,r,o){i.MODULEID[e.MODULEID].ITEMID[e.ITEMID]={},i.MODULEID[e.MODULEID].ITEMID[e.ITEMID].FUNCTIONID={}}),angular.forEach(n,function(e,r,o){i.MODULEID[e.MODULEID].ITEMID[e.ITEMID].FUNCTIONID[e.FUNCTIONID]=!0}),i)),s.resolve(t.getAuthorities()))})),s.promise).then(function(e){r.finAuthorities=!0}),(i=$.defer(),g.XML("WATERMARK",function(e){e&&(t.setWATERMARK(e.data[0]),i.resolve(t.getWATERMARK()))}),i.promise).then(function(e){r.finWatermark=!0})]).then(function(){window.location="MobilePlatform.html"})},e.ApplicationID=uuid(),I=[{LABEL:"SINGLE",DATA:1},{LABEL:"TOTAL",DATA:10}],h=!!navigator.userAgent.match("Safari"),t.setDialogCounts(I),g.XML("MAX_DIALOG_COUNT",function(e){e&&(I=0!=e.data[0].length?e.data[0]:I,t.setDialogCounts(I))}),t.setNavigator(h),r.wson()}]);