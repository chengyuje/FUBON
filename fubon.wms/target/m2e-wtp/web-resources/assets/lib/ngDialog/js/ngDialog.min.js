!function(T,F){"use strict";var e=F.module("ngDialog",[]),N=F.element,o=F.isDefined,n=(document.body||document.documentElement).style,l=o(n.animation)||o(n.WebkitAnimation)||o(n.MozAnimation)||o(n.MsAnimation)||o(n.OAnimation),t="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",a=!1;e.provider("ngDialog",function(){var w=this.defaults={className:"ngdialog-theme-default",plain:!1,showClose:!1,closeByDocument:!1,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0};this.setForceBodyReload=function(e){a=e||!1},this.setDefaults=function(e){F.extend(w,e)};var S,E=0,A=0,P={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","sysInfoService",function(e,u,p,m,f,C,D,h,v,y){var b=e.find("body");a&&C.$on("$locationChangeSuccess",function(){b=e.find("body")});var k={onDocumentKeydown:function(e){27===e.keyCode&&B.close("$escape")},setBodyPadding:function(e){var o=parseInt(b.css("padding-right")||0,10);b.css("padding-right",o+e+"px"),b.data("ng-dialog-original-padding",o)},resetBodyPadding:function(){var e=b.data("ng-dialog-original-padding");e?b.css("padding-right",e+"px"):b.css("padding-right","")},performCloseDialog:function(e,o){var n,a=e.attr("id");if(void 0!==T.Hammer?((n=F.element(e).scope().hammerTime).off("tap",S),n.destroy(),delete e.scope().hammerTime):e.off("click"),1===A&&b.off("keydown"),e.hasClass("ngdialog-closing")||--A,C.$broadcast("ngDialog.closing",e),l)e.off(t).on(t,function(){try{e.scope().$destroy()}catch(e){}e.remove(),0===A&&(b.removeClass("ngdialog-open"),k.resetBodyPadding()),C.$broadcast("ngDialog.closed",e)}).addClass("ngdialog-closing");else{try{e.scope().$destroy()}catch(e){}e.remove(),0===A&&(b.removeClass("ngdialog-open"),k.resetBodyPadding()),C.$broadcast("ngDialog.closed",e)}P[a]&&(P[a].resolve({id:a,value:o,$dialog:e,remainingDialogs:A}),delete P[a])},closeDialog:function(e,o){var n=e.data("$ngDialogPreCloseCallback");n&&F.isFunction(n)?(n=n.call(e,o),F.isObject(n)?n.closePromise?n.closePromise.then(function(){k.performCloseDialog(e,o)}):n.then(function(){k.performCloseDialog(e,o)},function(){}):!1!==n&&k.performCloseDialog(e,o)):k.performCloseDialog(e,o)}},B={open:function(e){var o=!!y.getDialogCounts(),n=!!C.$counter,a=0;if(0!=$(this.$result).find(".modal-header h4").text().trim().length&&n&&o){if(o=y.getDialogCounts(),0==(a=(n=C.$counter.total).length))$("html,body").css("overflow","auto");else{for(var l=0,t=0;t<a;t+=1)$(n[t].element).is(":hidden")&&(l+=1);l==a?$("html,body").css("overflow","auto"):$("html,body").css("overflow","hidden")}if(a>=o[1].DATA)return void C.showWarningMsg("系統彈跳視窗開啟數量已達上限。")}var i=this,s=F.copy(w);e=e||{},F.extend(s,e),E+=1,i.latestID="ngdialog"+E,P[i.latestID]=e=m.defer();var c,r,d=(F.isObject(s.scope)?s.scope:C).$new();return m.when(function(e){if(!e)return"Empty template";if(F.isString(e)&&s.plain)return e;return"boolean"!=typeof s.cache||s.cache?u.get(e)||g(e,{cache:!0}):g(e,{cache:!1})}(s.template||s.templateUrl)).then(function(e){var o,n;return u.put(s.template||s.templateUrl,e),s.showClose&&(e+='<div class="ngdialog-close"></div>'),i.$result=c=N('<div id="ngdialog'+E+'" class="ngdialog"></div>'),c.html(s.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content">'+e+"</div>":'<div class="ngdialog-content">'+e+"</div>"),s.data&&F.isString(s.data)?(o=s.data.replace(/^\s*/,"")[0],d.ngDialogData="{"===o||"["===o?F.fromJson(s.data):s.data):s.data&&F.isObject(s.data)&&(d.ngDialogData=F.fromJson(F.toJson(s.data))),s.controller&&(F.isString(s.controller)||F.isArray(s.controller)||F.isFunction(s.controller))&&(o=v(s.controller,{$scope:d,$element:c}),c.data("$ngDialogControllerController",o)),s.className&&c.addClass(s.className),r=s.appendTo&&F.isString(s.appendTo)?F.element(document.querySelector(s.appendTo)):b,s.preCloseCallback&&(F.isFunction(s.preCloseCallback)?n=s.preCloseCallback:F.isString(s.preCloseCallback)&&d&&(F.isFunction(d[s.preCloseCallback])?n=d[s.preCloseCallback]:d.$parent&&F.isFunction(d.$parent[s.preCloseCallback])?n=d.$parent[s.preCloseCallback]:C&&F.isFunction(C[s.preCloseCallback])&&(n=C[s.preCloseCallback])),n&&c.data("$ngDialogPreCloseCallback",n)),d.closeThisDialog=function(e){k.closeDialog(c,e)},D(function(){p(c)(d);var e=h.innerWidth-b.prop("clientWidth");b.addClass("ngdialog-open");e-=h.innerWidth-b.prop("clientWidth");0<e&&k.setBodyPadding(e),r.append(c),s.name?C.$broadcast("ngDialog.opened",{dialog:c,name:s.name}):C.$broadcast("ngDialog.opened",c)}),s.closeByEscape&&b.on("keydown",k.onDocumentKeydown),s.closeByNavigation&&C.$on("$locationChangeSuccess",function(){k.closeDialog(c)}),S=function(e){var o=!!s.closeByDocument&&N(e.target).hasClass("ngdialog-overlay"),e=N(e.target).hasClass("ngdialog-close");(o||e)&&B.close(c.attr("id"),e?"$closeButton":"$document")},void 0!==T.Hammer?(d.hammerTime=T.Hammer(c[0])).on("tap",S):c.on("click",S),A+=1,B}),{id:"ngdialog"+E,closePromise:e.promise,close:function(e){k.closeDialog(c,e)}};function g(e,o){return f.get(e,o||{}).then(function(e){return e.data||""})}},openConfirm:function(e){var n=m.defer(),o={closeByEscape:!1,closeByDocument:!1};F.extend(o,e),o.scope=(F.isObject(o.scope)?o.scope:C).$new(),o.scope.confirm=function(e){n.resolve(e);var o=N(document.getElementById(a.id));k.performCloseDialog(o,e)};var a=B.open(o);return a.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise},close:function(e,o){e=N(document.getElementById(e));return e.length?k.closeDialog(e,o):B.closeAll(o),B},closeAll:function(o){var e=document.querySelectorAll(".ngdialog");F.forEach(e,function(e){k.closeDialog(N(e),o)})},getDefaults:function(){return w}};return B}]}),e.directive("ngDialog",["ngDialog",function(l){return{restrict:"A",scope:{ngDialogScope:"="},link:function(n,e,a){e.on("click",function(e){e.preventDefault();var o=F.isDefined(n.ngDialogScope)?n.ngDialogScope:"noScope";F.isDefined(a.ngDialogClosePrevious)&&l.close(a.ngDialogClosePrevious);e=l.getDefaults();l.open({template:a.ngDialog,className:a.ngDialogClass||e.className,controller:a.ngDialogController,scope:o,data:a.ngDialogData,showClose:"false"!==a.ngDialogShowClose&&("true"===a.ngDialogShowClose||e.showClose),closeByDocument:"false"!==a.ngDialogCloseByDocument&&("true"===a.ngDialogCloseByDocument||e.closeByDocument),closeByEscape:"false"!==a.ngDialogCloseByEscape&&("true"===a.ngDialogCloseByEscape||e.closeByEscape),preCloseCallback:a.ngDialogPreCloseCallback||e.preCloseCallback})})}}}])}(window,window.angular);