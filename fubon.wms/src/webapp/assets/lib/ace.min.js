
var ACNO_SA_global;
var s1_global;
var s2_global;
var s3_global;
var BAMT1;
var REF;
var WD_PSW;
var ITEM;
var PB_NO;
var INT_DATE;
var CARD_NO;

var Is1_global;
var Is2_global;
var Is3_global;

var I_PB_NO;
var I_REF;
var I_CareQ;
var B_VB_TYPE;
var B_CARD_NO;

var EJ_UserID="";
var EJ_Wsid="";
var EJ_TIME_TIME=""; 
var EJ_S_TIME=""; 
var EJ_E_TIME="";
var total_tabs = 0;

/*
 * 把半形字串轉成全形
 * @return 全形字串
 */
String.prototype.halfToFull = function () {
    var temp = "";
    for (var i = 0; i < this.toString().length; i++) {
        var charCode = this.toString().charCodeAt(i);
        if (charCode <= 126 && charCode >= 33) {
            charCode += 65248;
        } else if (charCode == 32) { // 半形空白轉全形
            charCode = 12288;
        }
        temp = temp + String.fromCharCode(charCode);
    }
    return temp;
};
//檢查只能輸入數字
function check_intkeyNumber(key) {
    if (key >= 48 && key <= 57) {
        return true;　
    } else {　　
        return false;　
    }
}
//功能選項驗證
function check_onSelect(key, id) {
    $("#" + id).val(key-48);
}
jQuery(function () {
    handle_side_menu();
    enable_search_ahead();
    add_browser_detection(jQuery);
    general_things();
    widget_boxes();
    $(document).off("click.dropdown-menu")
});

//$(function () {
function aceInit(){
	console.log('ace.min.js init');
    $("#gn_Main").hide();
    $('#gn_search').hide();
    // initialize first tab
    // total_tabs++;
    // addtab(total_tabs);
    $("#gn").click(function () {
        showgn();
    });

    function showgn() {
        $("#work1_menu li").removeClass("active");
        $("#gn").addClass("active");
        $("#poc_Main").hide();
        $("#gn_search").hide();
        $("#gn_Main").fadeIn('slow');
    };

    $("#poc").click(function () {
        showpoc();
    });

    function showpoc() {
        $("#work1_menu li").removeClass("active");
        $("#poc").addClass("active");
        $("#gn_Main").hide();
         $("#gn_search").hide();
        $("#poc_Main").fadeIn('slow');

    };

    $("#search_nav").click(function () {
        console.log("search_nav");
        showsearch();
    });

    function showsearch() {
        $("#work1_menu li").removeClass("active");
        $("#search_nav").addClass("active");
        $("#gn_Main").hide();
        $("#poc_Main").hide();
        $("#gn_search").fadeIn('slow');
    };

    // $(".addtab, #litab").click(function () {
    //     total_tabs++;
    //     $("#tabcontent p").hide();
    //     var tabname = $(this).attr('id');
    //     console.log(tabname);
    //     addtab(total_tabs, tabname);
    //     return false;
    // });

     //快速開啟
        $(".business_input").keypress(function(e){
          code = (e.keyCode ? e.keyCode : e.which);
          if (code == 13)
          { 
              var keynum=$(this).val();
              console.log(keynum);
              switch(keynum){
                case "110320":
                total_tabs++;
                addtab(total_tabs, "A110320");
                break;

                case "120606":
                total_tabs++;
                addtab(total_tabs, "A120606");
                break;
              }
          }
        });
    //<li class="active"><a data-toggle="tab" href="#task-tab">主選單</a></li>
    function addtab(count, nameID) {
        var inputValue = $("#" + nameID + "").text();
        console.log(inputValue);
        var closetab = '<span href="" id="close' + count + '" class="close" style="  position: absolute; right: 1px; padding: 0px 3px 0px 3px;text-align: right;">&times;</span> ';
        $("#recent-tab li").removeClass("active");
        $("#task-tab").removeClass("active");
        $("#recent-tab").append('<li class="active" ><a data-toggle="tab" href="#t' + count + '"> <span class="text_title_size">' + inputValue + '</span>&nbsp;&nbsp;' + closetab + '</a></li>');
        switch (inputValue) {
        case "黃金存摺餘額/部分餘額證明":
            onA120606_init(count, inputValue);
            break;
        case "A. A110000 存款轉帳收入":
            //A. A110000 存款轉帳收入
            console.log("A. A110000");
            $("#tabnav_menu").append('<div id="t' + count + '" class="tab-pane active " ><div class="widget-header"><h4>        ' + inputValue + '</h4></div><div class="widget-body"><div class="widget-main"><form class="form-horizontal"><div class="row-fluid"><div class="span6"><div class="control-group "id="ACNO_control-group"><label class="control-label" for="form-field-1">                            存款帳號</label><div class="controls" id="ACNO_control" ><span class="span6 input-icon input-icon-right" id="ACNO_control_span"><input class="input-medium input-mask-eyescript" type="text" id="ACNO_form-field-mask-1"></span><span class="help-inline" style="margin-top:5px; display:none" id="ACNO_control_span_help-inline" >存款帳號錯誤</span></div></div></div><div class="span6"><div class="control-group " id="DepAmount_control-group"><label class="control-label" for="form-field-1">                            存款額數</label><div class="controls" id="DepAmount_control"><input class="input-medium"  type="text" id="DepAmount_form-field-mask-1" ></div></div></div></div><div class="row-fluid"><div class="span6"><div class="control-group " id="Currency_control-group"><label class="control-label" for="form-field-1">                                幣別</label><div class="controls" id="Currency_control"><select id="Currency_form-field-select-1" class="input-medium"><option value=""></option><option value="AL">                                    Alabama</option><option value="AK">                                    Alaska</option><option value="AZ">                                    Arizona</option></select></div></div></div><div class="span6"><div class="control-group " id="Passbook_control-group"><label class="control-label" for="form-field-1">                                    存摺行數</label><div class="controls" id="Passbook_control"><input class="span2 limited"  type="text" id="Passbook_form-field-mask-1" ></div></div></div></div><div class="row-fluid"><div class="span6"><div class="control-group " id="Price_control-group"><label class="control-label" for="form-field-1">                            金額</label><div class="controls" id="Price_control"><input class="input-medium" type="text" id="Price_form-field-mask-1"></div></div></div><div class="span6"><div class="control-group " id="FoldNo_control-group"><label class="control-label" for="form-field-1">                                摺號</label><div class="controls" id="FoldNo_control"><input class="span3 limited"  type="text" id="FoldNo_form-field-mask-1" ></div></div></div></div><div class="row-fluid"><div class="span6"><div class="control-group " id="Remark_control-group"><label class="control-label" for="form-field-1">                                附註</label><div class="controls" id="Remark_control"><input class="input-medium" type="text" id="Remark_form-field-mask-1"></div></div></div><div class="span6"><div class="control-group " id="Date_control-group"><label class="control-label" for="form-field-1">                                起息日</label><div class="controls" id="Date_control"><input class="input-medium"  type="text" id="Date_form-field-mask-1" ></div></div></div></div><div class="row-fluid"><div class="span12"><div class="control-group " id="Question_control-group"><label class="control-label" for="form-field-1">                                關懷提問</label><div class="controls" id="Question_control"><select id="Question_form-field-select-1" class="span5 limited"><option value=""></option><option value="WA">                                    Washington</option><option value="WV">                                    West Virginia</option><option value="WI">                                    Wisconsin</option><option value="WY">                                    Wyoming</option></select></div></div></div></div><div class="control-group ">&nbsp;</div><div class="hr"></div><br><div class="row-fluid"><div class="span12"><div class="control-group " id="UserName_control-group"><label class="control-label" for="form-field-1">                                戶名</label><div class="controls" id="UserName_control"><input class="span5 limited"  type="text" id="UserName_form-field-mask-1" ></div></div></div></div><div class="form-actions"><button onclick="return false;" class="btn btn-info" id="a110000_submit" type="submit"><i class="icon-ok"></i>送出</button>                    &nbsp; &nbsp; &nbsp;<button class="btn" type="reset"><i class="icon-undo"></i>取消</button></div></form></div></div></div>');
            break;

        case "分行電子日誌查詢/列印":
            onSIEJ001_init(count, inputValue);
            break;

        case "110320+110220 整合性交易":
            onA110320_init(count, inputValue);
            break;
        }

        $("#close" + count).bind("click", function () {
            // activate the previous tab
            $("#tabnav_menu div").removeClass("active");
            $("#recent-tab li").removeClass("active");
            $("#tabcontent p").hide();
            console.log("count : "+count);
            var num=count+1;
            for (var a=0;a<count;a++)
            {
             $("#t" + a).removeClass("active");
             
            }

            $(this).parent().remove();
            $("#c" + count).remove();
            $("#t" + count).remove();
            $('#task-tab').addClass("active");
            $('#nav_tab_main').addClass("active");

            return false;
        });
    }
}
//});

function handle_side_menu() {
    $("#menu-toggler").on("click", function () {
        $("#sidebar").toggleClass("display");
        $(this).toggleClass("display");
        return false
    });
    var a = false;
    $("#sidebar-collapse").on("click", function () {
        $("#sidebar").toggleClass("menu-min");
        $(this.firstChild).toggleClass("icon-double-angle-right");
        a = $("#sidebar").hasClass("menu-min");
        if (a) {
            $(".open > .submenu").removeClass("open")
        }
    });
    $(".nav-list .dropdown-toggle").each(function () {
        var b = $(this).next().get(0);
        $(this).on("click", function () {
            if (a) {
                return false
            }
            $(".open > .submenu").each(function () {
                if (this != b && !$(this.parentNode).hasClass("active")) {
                    $(this).slideUp(200).parent().removeClass("open")
                }
            });
            $(b).slideToggle(200).parent().toggleClass("open");
            return false
        })
    })
}

function enable_search_ahead() {
    var a = $("#nav-search-input");
    a.typeahead({
        source: ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Dakota", "North Carolina", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"],
        updater: function (b) {
            a.focus();
            return b
        }
    })
}

function general_things() {
    $('.ace-nav [class*="icon-animated-"]').closest("a").on("click", function () {
        var b = $(this).find('[class*="icon-animated-"]').eq(0);
        var a = b.attr("class").match(/icon\-animated\-([\d\w]+)/);
        b.removeClass(a[0]);
        $(this).off("click")
    });
    $("#ace-settings-btn").on("click", function () {
        $(this).toggleClass("open");
        $("#ace-settings-box").toggleClass("open")
    });
    $("#ace-settings-header").removeAttr("checked").on("click", function () {
        if (this.checked) {
            $(".navbar.navbar-inverse").addClass("navbar-fixed-top");
            $(document.body).addClass("navbar-fixed")
        } else {
            $(".navbar.navbar-inverse").removeClass("navbar-fixed-top");
            $(document.body).removeClass("navbar-fixed");
            if ($("#ace-settings-sidebar").get(0).checked) {
                $("#ace-settings-sidebar").click()
            }
        }
    });
    $("#ace-settings-sidebar").removeAttr("checked").on("click", function () {
        if (this.checked) {
            $("#sidebar").addClass("fixed");
            if (!$("#ace-settings-header").get(0).checked) {
                $("#ace-settings-header").click()
            }
        } else {
            $("#sidebar").removeClass("fixed")
        }
    });
    $("#btn-scroll-up").on("click", function () {
        var a = Math.max(100, parseInt($("html").scrollTop() / 3));
        $("html,body").animate({
            scrollTop: 0
        }, a);
        return false
    });
    $("#skin-colorpicker").ace_colorpicker().on("change", function () {
        var b = $(this).find("option:selected").data("class");
        var a = $(document.body);
        a.attr("class", a.hasClass("navbar-fixed") ? "navbar-fixed" : "");
        if (b != "default") {
            a.addClass(b)
        }
        if (b == "skin-1") {
            $(".ace-nav > li.grey").addClass("dark")
        } else {
            $(".ace-nav > li.grey").removeClass("dark")
        } if (b == "skin-2") {
            $(".ace-nav > li").addClass("no-border margin-1");
            $(".ace-nav > li:not(:last-child)").addClass("white-pink").find('> a > [class*="icon-"]').addClass("pink").end().eq(0).find(".badge").addClass("badge-warning")
        } else {
            $(".ace-nav > li").removeClass("no-border").removeClass("margin-1");
            $(".ace-nav > li:not(:last-child)").removeClass("white-pink").find('> a > [class*="icon-"]').removeClass("pink").end().eq(0).find(".badge").removeClass("badge-warning")
        } if (b == "skin-3") {
            $(".ace-nav > li.grey").addClass("red").find(".badge").addClass("badge-yellow")
        } else {
            $(".ace-nav > li.grey").removeClass("red").find(".badge").removeClass("badge-yellow")
        }
    })
}

function widget_boxes() {
    $(".widget-toolbar > a[data-action]").each(function () {
        var f = $(this);
        var h = f.data("action");
        var e = f.closest(".widget-box");
        if (h == "collapse") {
            var d = e.find(".widget-body");
            var b = f.find("[class*=icon-]").eq(0);
            var a = b.attr("class").match(/icon\-(.*)\-(up|down)/);
            var c = "icon-" + a[1] + "-down";
            var g = "icon-" + a[1] + "-up";
            d = d.wrapInner('<div class="widget-body-inner"></div>').find(":first-child").eq(0);
            f.on("click", function (i) {
                if (e.hasClass("collapsed")) {
                    if (b) {
                        b.addClass(g).removeClass(c)
                    }
                    e.removeClass("collapsed");
                    d.slideDown(200)
                } else {
                    if (b) {
                        b.addClass(c).removeClass(g)
                    }
                    d.slideUp(300, function () {
                        e.addClass("collapsed")
                    })
                }
                i.preventDefault()
            });
            if (e.hasClass("collapsed") && b) {
                b.addClass(c).removeClass(g)
            }
        } else {
            if (h == "close") {
                f.on("click", function (i) {
                    e.hide(300, function () {
                        e.remove()
                    });
                    i.preventDefault()
                })
            } else {
                if (h == "reload") {
                    f.on("click", function (j) {
                        f.blur();
                        var i = false;
                        if (!e.hasClass("position-relative")) {
                            i = true;
                            e.addClass("position-relative")
                        }
                        e.append('<div class="widget-box-layer"><i class="icon-spinner icon-spin icon-2x white"></i></div>');
                        setTimeout(function () {
                            e.find("> div:last-child").remove();
                            if (i) {
                                e.removeClass("position-relative")
                            }
                        }, parseInt(Math.random() * 1000 + 1000));
                        j.preventDefault()
                    })
                } else {
                    if (h == "settings") {
                        f.on("click", function (i) {
                            i.preventDefault()
                        })
                    }
                }
            }
        }
    })
}

function add_browser_detection(c) {
    if (!c.browser) {
        var a, b;
        c.uaMatch = function (e) {
            e = e.toLowerCase();
            var d = /(chrome)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+)/.exec(e) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e) || /(msie) ([\w.]+)/.exec(e) || e.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e) || [];
            return {
                browser: d[1] || "",
                version: d[2] || "0"
            }
        };
        a = c.uaMatch(navigator.userAgent);
        b = {};
        if (a.browser) {
            b[a.browser] = true;
            b.version = a.version
        }
        if (b.chrome) {
            b.webkit = true
        } else {
            if (b.webkit) {
                b.safari = true
            }
        }
        c.browser = b
    }
};