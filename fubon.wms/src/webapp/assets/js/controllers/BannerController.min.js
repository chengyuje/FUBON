eSoafApp.controller("BannerController",["$rootScope","$scope","$controller","$http","$cookies","socketService","sysInfoService","projInfoService","$confirm","ngDialog","$window","getParameter",function(e,t,n,o,s,r,i,a,c,l,u,S){n("BaseController",{$scope:t}),t.IsMobile="mobile"==a.getLoginSourceToken(),t.role=i.getPriID()[0],t.canQuick=!0,t.sendRecv("CRM911","checkQuick","com.systex.jbranch.app.server.fps.crm911.CRM911InputVO",{},function(e,n){n||angular.forEach(e[0].body.resultList,function(e){e.PARAM_CODE==t.role&&(t.canQuick=!1)}),S.XML(["SYS.AAS_SSO_ACC_PW","SYS.FMA_SSO_ACC_PW"],function(e){if(e){var n=e.data[e.key.indexOf("SYS.AAS_SSO_ACC_PW")];t.AAS_SSO_ACC_PW_ENABLED=!1,angular.forEach(n,function(e,n){"ENABLED"==e.DATA&&(t.AAS_SSO_ACC_PW_ENABLED="Y"==e.LABEL)}),t.FMA_SSO_ACC_PW=e.data[e.key.indexOf("SYS.FMA_SSO_ACC_PW")],t.FMA_SSO_ACC_PW_ENABLED=!1,angular.forEach(t.FMA_SSO_ACC_PW,function(e,n){"ENABLED"==e.DATA&&(t.FMA_SSO_ACC_PW_ENABLED="Y"==e.LABEL)})}})}),t.reload=function(){t.$emit("e-unload-alert","MobilePlatform")},t.switchRole=function(){var e=t.userList;l.open({template:"assets/txn/CMFPG000/CMFPG000_AGENT.html",className:"CMFPG000",showClose:!1,controller:["$scope",function(t){t.userList=e}]}).closePromise.then(function(e){"successful"===e.value&&t.setSysInfoService(a.LoginInfo)})},t.custExist="N",t.order=function(){"ID"==t.inputVO.crm110Type&&(t.inputVO.cust_id=t.inputVO.cust.toUpperCase()),t.inputVO.orderOption=void 0,t.custExist="Y"},t.change=function(){t.custExist="N"},t.selectOption=function(){for(var n=["SOT110","SOT111","SOT130","SOT140","SOT150","SOT120","SOT121","SOT210","SOT211","SOT220","SOT221","SOT310","SOT320","SOT410","SOT420","SOT510","SOT520"],o=!1,s=0;s<n.length;s++)if(t.inputVO.orderOption==n[s]){o=!0;break}o?t.connector("set","SOTCustID",t.inputVO.cust):t.connector("set","ORG110_custID",t.inputVO.cust),e.menuItemInfo.url="assets/txn/"+t.inputVO.orderOption+"/"+t.inputVO.orderOption+".html"},t.loginOut=function(){c({text:"確定 個金分行業務管理系統?"},{size:"sm"}).then(function(){t.sendRecv("CMFPG000","tlroff","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{},function(e,n){n?t.msgData=e.body.msgData:(a.setApServerName(null),a.setUserList(null),a.setUserID(null),a.setUserName(null),a.setApplicationID(null),a.setBranchID(null),a.setBranchName(null),a.setWsID(null),a.setRoleID(null),a.setRoleName(null),a.setAvailBranch(null),a.setAvailRegion(null),a.setAvailArea(null),a.setUser(null),a.setAoCode(null),t.$emit("e-unload-alert","Login"))})})},t.chkToken=function(e){e.preventDefault(),null!=u.navigator.userAgent.match(/iPad;\s.*\sMac\s.*/i)||"mobile"==i.getLoginSourceToken()?t.sendRecv("SSO001","takeToken","java.util.HashMap",{id:i.getUserID()},function(e,n){n||(window.webkit.messageHandlers.jumpMappMethod?window.webkit.messageHandlers.jumpMappMethod.postMessage(e[0].body.MAPP_URL):window.location=e[0].body.MAPP_URL,void 0!=e[0].body.errMsg&&t.showErrorMsg(e[0].body.errMsg))}):t.sendRecv("SSO001","doGeESoafWebUrl","java.util.HashMap",{id:i.getUserID()},function(e,n){n||(window.open(e[0].body.url),void 0!=e[0].body.errMsg&&t.showErrorMsg(e[0].body.errMsg))})},t.goMFA=function(){t.sendRecv("SSO003","takeToken","java.util.HashMap",{id:i.getUserID()},function(e,n){if(!n){if(e[0].body.errMsg)t.showErrorMsg(e[0].body.errCode+":"+e[0].body.errMsg);else{t.sendData={encryptedEmp:e[0].body.encryptData};var o=document.createElement("form");o.method="POST",o.action=t.FMA_SSO_ACC_PW[0].LABEL;var s=document.createElement("input");s.type="hidden",s.name="encryptedEmp",s.value=e[0].body.encryptData,o.appendChild(s),o.target="_blank",document.body.appendChild(o),o.submit(),document.body.removeChild(o)}return}})}}]);