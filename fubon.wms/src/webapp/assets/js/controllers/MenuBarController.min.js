eSoafApp.controller("MenuBarController",["$rootScope","$scope","$http","$cookies","socketService","sysInfoService","$timeout","withLazyModule","$q","getParameter",function(I,u,e,n,t,E,r,a,o,M){function i(e){E.$currentTxn=e.txnId,document.oncontextmenu=new Function("return false "),document.ondragstart=new Function("return false ");var n=!1;E.getAuthorities()&&E.getAuthorities().MODULEID[E.$currentModule].ITEMID[E.$currentTxn]&&E.getAuthorities().MODULEID[E.$currentModule].ITEMID[E.$currentTxn].FUNCTIONID.screen&&(n=!0);var t=!1;$(document).on("keydown",function(e){17!=e.keyCode&&91!=e.keyCode||(t=!0)}).on("keyup",function(e){17!=e.keyCode&&91!=e.keyCode||(t=!1)}),$(document).on("keydown",function(e){t&&67==e.keyCode&&((e=document.createElement("input")).setAttribute("value",""),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e))}).on("keyup",function(e){n&&44==e.keyCode&&((e=document.createElement("input")).setAttribute("value",""),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e))}),document.getElementById("watermark").className="hidden",E.getAuthorities()&&E.getAuthorities().MODULEID[E.$currentModule].ITEMID[E.$currentTxn]&&E.getAuthorities().MODULEID[E.$currentModule].ITEMID[E.$currentTxn].FUNCTIONID.watermark&&(document.getElementById("watermark").className="watermark"),"HOME"!=e.txnId?u.txnPath=e.txnPath:u.txnPath=void 0,I.menuItemInfo={url:"",txnId:e.txnId,txnName:e.txnName},r(function(){I.menuItemInfo={url:"assets/txn/"+e.txnId+"/"+e.txnId+".html",txnId:e.txnId,txnName:e.txnName,txnPath:u.txnPath}}).then(function(){u.menuNon()})}u.priID=E.getPriID()[0],u.UserName=E.getUserName(),u.RoleName=E.getRoleName(),u.BranchName=1<E.getAvailBranch().length||"null"==E.getBranchName()||"004AO"==u.priID?"":E.getBranchName(),u.isLocal=-1<E.Exclude.IP.indexOf(document.location.hostname),I.GENERATE_MENU=function(){I.MenuBar=angular.copy(E.getMenu());var t,a="mobile"==E.getLoginSourceToken(),M=E.getPriID()[0];t=o.defer(),u.sendRecv("CMMGR020","getMobileAUTH","com.systex.jbranch.app.server.fps.cmmgr020.CMMGR020ItemVO",{},function(e,n){n||t.resolve(e[0].body.data)}),t.promise.then(function(e){!function e(n,t){for(var r=n.length-1;0<=r;r--)"P"==n[r].MENU_TYPE?(!E.getAuthorities().MODULEID[E.$currentModule].ITEMID[n[r].MENU_ID]||a&&-1==_.findIndex(t,function(e){return e.ITEMID==n[r].MENU_ID&&e.PRIVILEGEID==M}))&&n.splice(r,1):n[r].SUBITEM&&(e(n[r].SUBITEM,t),0==n[r].SUBITEM.length&&n.splice(r,1))}(I.MenuBar,e)}),u.sendRecv("CRM911","initial","com.systex.jbranch.app.server.fps.crm911.CRM911InputVO",{emp_id:E.getUserID()},function(e,n){var t;n||(t=[],angular.forEach(e[0].body.resultList,function(e){t.push({MENU_ID:e.LINK_URL,MENU_NAME:e.LINK_NAME,MENU_TYPE:"U"})}),I.MenuBar.push({MENU_ID:"TEST",MENU_NAME:"常用連結",MENU_TYPE:"F",SEQ_NUM:7,SUBITEM:[{MENU_ID:"TEST",MENU_NAME:"常用連結",MENU_TYPE:"F",SEQ_NUM:1,SUBITEM:t}]}))})},u.menuVisible=function(e,n){document.getElementsByClassName("menuBar")[n].style.opacity=e?"1":"0",document.getElementsByClassName("menuBar")[n].style.visibility=e?"visible":"hidden"},u.menuNon=function(){$(".menuBar").each(function(e){$(this).css("visibility","hidden")})},u.GeneratePage=function(t){t.txnId=t.txnId.toUpperCase().trim(),"HOME"==t.txnId?i(t):"CRM351"==t.txnId?u.sendRecv("CRM351","check","com.systex.jbranch.app.server.fps.crm351.CRM351InputVO",{pri_id:E.getPriID()[0]},function(e,n){n||(0!=e[0].body.checkList.length?a("assets/txn/"+t.txnId+"/"+t.txnId,function(){i(t)},function(e){u.showErrorMsg(e)}):u.showMsg("組織人員管理功能中有註記離職、異動分行、留停者，才會開放此交接功能"))}):a("assets/txn/"+t.txnId+"/"+t.txnId,function(){i(t)},function(e){u.showErrorMsg(e)})},u.customEnter=function(e){e=e.toUpperCase(),u.GeneratePage({txnName:e,txnId:e,txnPath:[]})},I.MenuBarLink=function(e,n){var t=I.menuItemInfo.txnPath;switch(n){case 0:u.GeneratePage({txnName:"HOME",txnId:"HOME",txnPath:[{MENU_ID:"HOME",MENU_NAME:"首頁"}]});break;case 1:for(var r=0;r<I.MenuBar.length;r+=1){if(I.MenuBar[r].MENU_ID==e.MENU_ID&&"P"==I.MenuBar[r].MENU_TYPE){var a=t.map(function(e){return e.MENU_ID}).indexOf(e.MENU_ID);t.splice(-1,t.length-1-a),u.GeneratePage({txnName:I.MenuBar[r].MENU_NAME,txnId:I.MenuBar[r].MENU_ID,txnPath:t});break}if("F"==I.MenuBar[r].MENU_TYPE)for(var M=0;M<I.MenuBar[r].SUBITEM.length;M+=1){if(I.MenuBar[r].SUBITEM[M].MENU_ID==e.MENU_ID&&"P"==I.MenuBar[r].SUBITEM[M].MENU_TYPE){a=t.map(function(e){return e.MENU_ID}).indexOf(e.MENU_ID);t.splice(-1,t.length-1-a),u.GeneratePage({txnName:I.MenuBar[r].SUBITEM[M].MENU_NAME,txnId:I.MenuBar[r].SUBITEM[M].MENU_ID,txnPath:t});break}if("F"==I.MenuBar[r].SUBITEM[M].MENU_TYPE)for(var E=0;E<I.MenuBar[r].SUBITEM[M].SUBITEM.length;E+=1){if(I.MenuBar[r].SUBITEM[M].SUBITEM[E].MENU_ID==e.MENU_ID&&"P"==I.MenuBar[r].SUBITEM[M].SUBITEM[E].MENU_TYPE){a=t.map(function(e){return e.MENU_ID}).indexOf(e.MENU_ID);t.splice(-1,t.length-1-a),u.GeneratePage({txnName:I.MenuBar[r].SUBITEM[M].SUBITEM[E].MENU_NAME,txnId:I.MenuBar[r].SUBITEM[M].SUBITEM[E].MENU_ID,txnPath:t});break}if("F"==I.MenuBar[r].SUBITEM[M].SUBITEM[E].MENU_TYPE)for(var o=0;o<I.MenuBar[r].SUBITEM[M].SUBITEM[E].SUBITEM.length;o+=1)if(I.MenuBar[r].SUBITEM[M].SUBITEM[E].SUBITEM[o].MENU_ID==e.MENU_ID&&"P"==I.MenuBar[r].SUBITEM[M].SUBITEM[E].SUBITEM[o].MENU_TYPE){a=t.map(function(e){return e.MENU_ID}).indexOf(e.MENU_ID);t.splice(-1,t.length-1-a),I.GeneratePage({txnName:I.MenuBar[r].SUBITEM[M].SUBITEM[E].SUBITEM[o].MENU_NAME,txnId:I.MenuBar[r].SUBITEM[M].SUBITEM[E].SUBITEM[o].MENU_ID,txnPath:t});break}}}}}},I.GENERATE_MENU(),I.ApplicationID=E.getApplicationID(),I.BranchID=E.getBranchID(),I.WsID=E.getWsID(),null!=E.getUserID()?(I.TlrID=E.getUserID(),i({txnName:"首頁",txnId:"HOME",txnPath:[{MENU_ID:"HOME",MENU_NAME:"首頁"}]})):alert("無法取得使用者帳號"),I.GeneratePage=u.GeneratePage}]);