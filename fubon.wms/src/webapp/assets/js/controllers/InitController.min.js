"use strict";eSoafApp.controller("InitController",["$rootScope","$scope","$controller","projInfoService","socketService","ngDialog","$location","$interpolate","$timeout","$confirm","getParameter","sysInfoService",function(i,l,e,n,t,o,r,s,a,u,c,p){e("CMFPG000Controller",{$scope:l}),l.userList=n.getUserList(),l.UserID=n.getUserID(),l.ApplicationID=n.getApplicationID(),l.BranchID=n.getBranchID(),l.WsID=n.getWsID(),l.RoleID=n.getRoleID(),!1!==(l.UserID&&l.ApplicationID&&l.BranchID&&l.WsID&&l.RoleID)?(l.$counter=i.$counter,n.setDialogCounts([{LABEL:"SINGLE",DATA:2},{LABEL:"TOTAL",DATA:10}]),n.setNavigator(!!navigator.userAgent.match("Safari")),c.XML("SYS.MAX_DISPLAY_ROWS",function(e){len(e)?n.setSinglePageRows(e.data[0]):n.setSinglePageRows([{DATA:"DEFAULT",LABEL:"50"}])}),l.WATERMARK=[],angular.forEach(n.getWATERMARK(),function(e,t,n){l.WATERMARK.push({LABEL:l.$eval(s(e.LABEL))})}),i.$calendar={flag:[],list:[],time:15,stop:!1},n.setFileParameter([{DATA:"DEFAULT",LABEL:"10"}]),c.XML("TIMEOUT.LIMIT",function(e){len(e)?n.setServerParameter(e.data[0]):n.setServerParameter([{DATA:"DEFAULT",LABEL:"2"}])}),n.setMarqueeParameter([{DATA:"PERIOD",LABEL:"15"}]),i.$watchCollection("$counter.total",function(e,t,n){var l=i.$counter.total,o=i.$counter.total.length;if(0==o)$("html,body").css("overflow","auto");else{for(var r=0,s=0;s<o;s+=1)$(l[s].element).is(":hidden")&&(r+=1);r==o?$("html,body").css("overflow","auto"):$("html,body").css("overflow","hidden")}}),i.$watchCollection("$counter.visit",function(e,t,n){a(function(){var e=i.$counter.total,t=i.$counter.total.length;if(0==t)$("html,body").css("overflow","auto");else{for(var n=0,l=0;l<t;l+=1)$(e[l].element).is(":hidden")&&(n+=1);n==t?$("html,body").css("overflow","auto"):$("html,body").css("overflow","hidden")}},500)}),l.inputVO.AOlist=p.getAoCode(),l.inputVO.priID=String(p.getPriID()),("014"==l.inputVO.priID||"015"==l.inputVO.priID||"023"==l.inputVO.priID||"024"==l.inputVO.priID||0<l.inputVO.AOlist.length)&&(l.inputVO.LoginID=p.getUserID(),l.sendRecv("CRM1242","cancel","com.systex.jbranch.app.server.fps.crm1242.CRM1242InputVO",l.inputVO,function(e,t){if(!t)return l.resultList=e[0].body.resultList,void(null!=l.resultList&&0<l.resultList.length&&alert("您有"+l.resultList.length+"筆陪訪需求被退回"))})),"014"!=l.inputVO.priID&&"023"!=l.inputVO.priID||(l.inputVO.LoginID=p.getUserID(),l.sendRecv("CRM1243","change","com.systex.jbranch.app.server.fps.crm1243.CRM1243InputVO",l.inputVO,function(e,t){if(!t)return l.ListY=e[0].body.resultList,l.ListN=e[0].body.resultList2,void(null!=l.ListY&&0<l.ListY.length&&null!=l.ListN&&0<l.ListN.length?alert("您有"+l.ListY.length+"筆駐點變更已覆核\r\n您有"+l.ListN.length+"筆駐點變更被退回"):null!=l.ListY&&0<l.ListY.length?alert("您有"+l.ListY.length+"筆駐點變更已覆核"):null!=l.ListN&&0<l.ListN.length&&alert("您有"+l.ListN.length+"筆駐點變更被退回"))})),window.onbeforeunload=function(e){return""},i.$on("e-unload-alert",function(e,t){"MobilePlatform"==t?i.GeneratePage({txnName:"HOME",txnId:"HOME",txnPath:[{MENU_ID:"HOME",MENU_NAME:"首頁"}]}):(window.onbeforeunload=null,window.location=t+".html")}),l.tempUserInfo=p.getTempUserInfo(),l.tempUserLogoutConfirm=function(){u({title:"系統通知",text:"親愛的 "+l.tempUserInfo.EMP_NAME+" 您好：系統目前尚未開放使用，頁面將進入唯讀模式，可直接按「確定」進行登出，或稍後再進行，謝謝！"},{size:"sm"}).then(()=>{l.sendRecv("CMFPG000","tlroff","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{},function(e,t){t?l.msgData=e.body.msgData:(n.setApServerName(null),n.setUserList(null),n.setUserID(null),n.setUserName(null),n.setApplicationID(null),n.setBranchID(null),n.setBranchName(null),n.setWsID(null),n.setRoleID(null),n.setRoleName(null),n.setAvailBranch(null),n.setAvailRegion(null),n.setAvailArea(null),n.setUser(null),n.setAoCode(null),n.setTempUserInfo(null),l.$emit("e-unload-alert","Login"))})})},l.tempUserInfo&&l.tempUserLogoutConfirm()):l.$emit("e-unload-alert","Login")}]);
