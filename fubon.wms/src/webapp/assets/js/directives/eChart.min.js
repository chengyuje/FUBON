/**================================================================================================
@program: eChart.js
@description: 
@version: 1.0.20170313
=================================================================================================*/
/**================================================================================================
 						custom chart directive using jQuery-UI, AngularJS 												  
===================================================================================================
 @LastUpdate:
 			 2016/05/05 ArthurKO Add fontStyle
 			 2016/03/28 ArthurKO Add attrs
			 2016/03/22 ArthurKO Add directive
===================================================================================================
CHART(25):
"line", "stepLine", "spline", "column", "area", "stepArea", "splineArea", "bar", 
"bubble", "scatter", "stackedColumn", "stackedColumn100", "stackedBar", "stackedBar100",
"stackedArea", "stackedArea100","candlestick","ohlc","rangeColumn","rangeBar","rangeArea",
"rangeSplineArea","pie", "doughnut", "funnel"
=================================================================================================*/
eSoafApp.directive("eChart",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{id:"@?",title:"@?",exName:"@?",exFlag:"@?",axisY:"@?",axisX:"@?",alignV:"@?",alignH:"@?",thSize:"@?",fontStyle:"@?",toolStyle:"@?",width:"@?",height:"@?",theme:"@?",point:"@?",pointMin:"@?",pointMax:"@?",zoom:"@?",animation:"@?",data:"=?",tipShared:"@?",tipContent:"@?",xValueType:"@?",xIn:"@?",yIn:"@?",y2In:"@?",xfontSize:"@?",xtitleSize:"@?",xThickness:"@?",xMin:"@?",xMax:"@?",yMin:"@?",yMax:"@?",y2Min:"@?",y2Max:"@?",xAngle:"@",yFormat:"@?",yThickness:"@?",yfontSize:"@?",ytitleSize:"@?"},template:function(t,i){i.id||(i.id="eChart"+Math.floor(65536*(1+Math.random())).toString(16).substring(1));var e="300px",n="600px";i.height&&("-1"!=i.height.toString().toUpperCase().trim().indexOf("PX").toString()&&("-1"==i.height.toString().toUpperCase().trim().indexOf("%").toString()?i.height=i.height.toString().trim():i.height=i.height.toString().toUpperCase().trim().substring(0,i.height.toString().toUpperCase().trim().indexOf("%")-1)+"px"),"-1"==i.height.toString().toUpperCase().trim().indexOf("PX").toString()&&("-1"==i.height.toString().toUpperCase().trim().indexOf("%").toString()?i.height=i.height.toString().trim()+"px":i.height=i.height.toString().toUpperCase().trim().substring(0,i.height.toString().toUpperCase().trim().indexOf("%")-1)+"px")),i.width&&("-1"!=i.width.toString().toUpperCase().trim().indexOf("PX").toString()&&("-1"==i.width.toString().toUpperCase().trim().indexOf("%").toString()?i.width=i.width.toString().trim():i.width=i.width.toString().toUpperCase().trim().substring(0,i.width.toString().toUpperCase().trim().indexOf("%")-1)+"px"),"-1"==i.width.toString().toUpperCase().trim().indexOf("PX").toString()&&("-1"==i.width.toString().toUpperCase().trim().indexOf("%").toString()?i.width=i.width.toString().trim()+"px":i.width=i.width.toString().toUpperCase().trim().substring(0,i.width.toString().toUpperCase().trim().indexOf("%")-1)+"px")),i.height||(i.height=e),i.width||(i.width=n),console.log("==============================[e-chart info]=============================="),console.log("[temp] id:"+i.id+" height:"+i.height+" width:"+i.width),console.log("==============================[e-chart info]==============================");var r='<div style="height: {{height}}; width: {{width}};"><div id="{{id}}"></div></div>';return r},link:function(t,i,e,n,r){function o(){var i=300,e=600,n="",r=20,o="Microsoft JhengHei",a="normal",h=null,l=null,p="",g="",s=null,d=null,x="theme2",S=!0,m=!0,f=null,y=null,u=null,c=[],C=!0,I=null,w="number",U=null,M=null,z=null,O=10,F=16,b=0,X=null,P=null,v=null,T=null,k=null,A=null,V=null,N=null,Y=0,E=10,H=16;t.data&&(c=t.data),t.title&&(n=t.title),t.thSize&&(r=parseInt(t.thSize)),t.fontStyle&&(o=t.fontStyle),t.toolStyle&&(a=t.toolStyle),t.exName&&(h=t.exName),t.exFlag&&(l=t.exFlag),t.axisY&&(p=t.axisY),t.axisX&&(g=t.axisX),t.tipShared&&(C=t.tipShared),t.tipContent&&(I=t.tipContent),t.alignV&&(s=t.alignV),t.alignH&&(d=t.alignH),t.zoom&&(S=t.zoom),t.animation&&(m=t.animation),t.theme&&(x="theme"+t.theme),t.point&&(f=parseInt(t.point)),t.pointMin&&(y=parseInt(t.pointMin)),t.pointMax&&(u=parseInt(t.pointMax)),t.tipShared&&(C=t.tipShared),t.tipContent&&(I=t.tipContent),t.xValueType&&(w=t.xValueType),t.xIn&&(U=parseInt(t.xIn)),t.yIn&&(M=parseInt(t.yIn)),t.y2In&&(z=parseInt(t.y2In)),t.xfontSize&&(O=parseInt(t.xfontSize)),t.xtitleSize&&(F=parseInt(t.xtitleSize)),t.xThickness&&(b=parseInt(t.xThickness)),t.xMin&&(X=parseInt(t.xMin)),t.xMax&&(P=parseInt(t.xMax)),t.yMin&&(v=parseInt(t.yMin)),t.yMax&&(T=parseInt(t.yMax)),t.y2Min&&(k=parseInt(t.y2Min)),t.y2Max&&(A=parseInt(t.y2Max)),t.xAngle&&(V=parseInt(t.xAngle)),t.yFormat&&(N=t.yFormat),t.yThickness&&(Y=parseInt(t.yThickness)),t.yfontSize&&(E=parseInt(t.yfontSize)),t.ytitleSize&&(H=parseInt(t.ytitleSize)),t.height&&("-1"!=t.height.toString().toUpperCase().trim().indexOf("PX").toString()?i=parseInt(t.height.toString().toUpperCase().trim().substring(0,t.height.toString().toUpperCase().trim().indexOf("PX"))):"-1"==t.height.toString().toUpperCase().trim().indexOf("PX").toString()&&(i=parseInt(t.height.trim())),"-1"==t.height.toString().toUpperCase().trim().indexOf("%").toString()?("-1"!=t.height.toString().toUpperCase().trim().indexOf("PX").toString()&&(i=parseInt(t.height.toString().toUpperCase().trim().substring(0,t.height.toString().toUpperCase().trim().indexOf("PX")))),"-1"==t.height.toString().toUpperCase().trim().indexOf("PX").toString()&&(i=parseInt(t.height.trim()))):"-1"!=t.height.toString().toUpperCase().trim().indexOf("%").toString()&&(i=300)),t.width&&("-1"==t.width.toString().toUpperCase().trim().indexOf("%").toString()?("-1"!=t.width.toString().toUpperCase().trim().indexOf("PX").toString()&&(e=parseInt(t.width.toString().toUpperCase().trim().substring(0,t.width.toString().toUpperCase().trim().indexOf("PX")))),"-1"==t.width.toString().toUpperCase().trim().indexOf("PX").toString()&&(e=parseInt(t.width.trim()))):"-1"!=t.width.toString().toUpperCase().trim().indexOf("%").toString()&&(e=600)),console.log("====================== scope e-chart size ======================"),console.log("[ctrl] h:"+i+" w:"+e),console.log("====================== scope e-chart size ======================");var J=new CanvasJS.Chart(t.id,{theme:x,title:{text:n,fontSize:r,fontFamily:o},exportFileName:h,exportEnabled:l,zoomEnabled:S,animationEnabled:m,axisY:{labelFontFamily:o,title:p,interval:M,labelFontSize:E,minimum:v,maximum:T,titleFontSize:H},axisY2:{labelFontFamily:o,interval:z,valueFormatString:N,minimum:k,maximum:A,lineThickness:Y},axisX:{labelFontFamily:o,title:g,interval:U,labelFontSize:O,titleFontSize:F,lineThickness:b,minimum:X,maximum:P,labelAngle:V},toolTip:{fontStyle:a,shared:C,content:I},legend:{fontFamily:o,verticalAlign:s,horizontalAlign:d},data:c,height:i,width:e,dataPointWidth:f,dataPointMinWidth:y,dataPointMaxWidth:u,xValueType:w});J.render()}o(),t.$watch("data",function(t,i){t!=i&&o()}),console.log("=========================[e-chart Data]========================="),console.log(JSON.stringify(chart.options.data)),console.log("=========================[e-chart Data]=========================")}}});