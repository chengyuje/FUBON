/**================================================================================================
@program: eJumpingOnce.js
@description: 
@version: 1.0.20170313
=================================================================================================*/
eSoafApp.directive("eJumpingOnce", ["projInfoService", "getParameter", "$q", function (t, e, a) { return { restrict: "E", replace: !0, scope: { output: "=?", list: "=?", totalList: "=?totallist", isEnd: "=?isend", limitTotal: "@?limittotal", rowCountLimit: "=?rowcountlimit" }, template: function (t, e) { return '<div>\t<div  style="text-align:left;height:28px;margin-bottom:5px">\t\t<table style="display:block;">\t\t\t<tr>\t\t\t\t<td style="padding:0 3px 3px 0;"><a style="font-size:10px;height:28px;border-bottom-right-radius:0;border-top-right-radius:0;" class="btn btn-info" ng-click="Paging(0, 0)"><i style="margin-right:2.5px;" class="glyphicon glyphicon-step-backward"></i>上一頁</a></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><a style="font-size:10px;height:28px;border-bottom-left-radius:0;border-top-left-radius:0;" class="btn btn-info" ng-click="Paging(1, 1)">下一頁<i style="margin-left:2.5px;" class="glyphicon glyphicon-step-forward"></i></a></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><select class="form-control" style="width:75px;height:28px;display:inline;padding: 0px 12px;" ng-options="page as page.text for page in pages" ng-model="selectedPage" ng-change="jumpPage(selectedPage.text - 1)"></select></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><p style="display:inline;height:28px;">共&nbsp;</p></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><label style="display:inline;height:28px;">{{totalPage}}</label></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><p style="display:inline;height:28px;">&nbsp;頁&nbsp;/&nbsp;共&nbsp;</p></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><label style="display:inline;height:28px;">{{totalRecord}}</label></td>\t\t\t\t<td style="padding:0 3px 3px 0;"><p style="display:inline;height:28px;">&nbsp;筆資料</p></td>\t\t\t</tr>\t\t</table>\t</div></div>' }, link: function (n, l, o, p) { var s, r; n.limitTotal = n.limitTotal || "true", (s = n).rowCountLimit = s.rowCountLimit || parseInt(t.getSinglePageRows()[0].LABEL), s.pages = [], s.totalPage = 0, s.totalRecord = 0, s.currentPageIndex = 0, s.selectedPage = {}, (r = a.defer(), e.XML([["SYS", "MAX_QRY_ROWS"]], function (t) { if (t) { var e = function (t, e) { for (var a = 0; a < t.length; a++)if (t[a][0] == e[0] && t[a][1] == e[1]) return a; return -1 }(t.key, ["SYS", "MAX_QRY_ROWS"]); n.maxRecord = t.data[e][0].LABEL, r.resolve("success") } }), r.promise).then(function (t) { n.$watch("output", function (t, e) { n.output && (n.totalList = n.totalList || [], "true" == n.limitTotal && n.totalList.length > 0 && n.maxRecord < n.totalList.length && (n.totalList.splice(n.maxRecord, n.totalList.length), n.$parent.showWarningMsg("ehl_01_common_031")), n.output.totalPage = Math.ceil(n.totalList.length / n.rowCountLimit), n.output.totalRecord = n.totalList.length, i(n), n.jumpPage(n.output.currentPageIndex || 0)) }), n.$watch("currentPageIndex", function (t, e) { t != e && i(n) }) }), n.Paging = function (t, e) { switch (t) { case 0: var a = n.selectedPage.text - 2; if (!(a >= 0)) return; n.jumpPage(a); break; case 1: var i = n.selectedPage.text; if (!(i <= n.output.totalPage - 1)) return; n.jumpPage(i) } }, n.jumpPage = function (t) { n.currentPageIndex = t, n.isEnd = n.currentPageIndex == n.totalPage - 1, n.list = []; var e = [0, 0]; e[0] = t * n.rowCountLimit, n.totalList.length - e[0] >= n.rowCountLimit ? e[1] = e[0] + n.rowCountLimit - 1 : e[1] = n.totalList.length - 1; for (var a = e[0]; a <= e[1]; a += 1)n.list.push(n.totalList[a]) } } }; function i(t) { t.totalPage = t.output.totalPage, t.totalRecord = t.output.totalRecord, t.pages = []; for (var e = 1; e <= t.output.totalPage; e++)t.page = { name: "page " + e, text: e }, t.pages.push(t.page); t.selectedPage = t.pages[t.currentPageIndex], !t.pages[t.currentPageIndex] && t.currentPageIndex > 0 && (t.currentPageIndex -= 1) } }]);