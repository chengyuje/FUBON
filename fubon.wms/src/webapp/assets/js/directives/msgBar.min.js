eSoafApp.directive("msgBar",["$timeout","$interval","sysInfoService","socketService",function(t,o,i,e){return{restrict:"E",transclude:!0,replace:!0,scope:{},template:function(t,e){return'<div><div id="mwt_fb_tab"><a class="left_no"><span><i class="glyphicon glyphicon-chevron-right mwt_btn_color"></i></span><span class="mwt_btn_color">訊</span><span class="mwt_btn_color">息</span><span class="badge" ng-if="msglist.length>0" ng-bind="msglist.length"></span></a></div><div id="mwt_mwt_slider_scroll"><div id="mwt_slider_content"><div class="bootstrap-admin-panel-content in"><div class="row"><div class="col-lg-1 col-md-1 col-sm-1"></div><div id="mwt_msg_panl" class="col-lg-11 col-md-11 col-sm-11"><div id="e-msgbar-clear" class="text-right" ng-if="msglist.length>0"><span ng-click="remove(null,true)"><i class="glyphicon glyphicon-trash"></i> 全部清除</span></div>'+"<div ng-init=\"insert(row)\" id=\"mwt_msg_box\" style=\"border-radius:5px!important;line-height:25px;text-align:left;animation: ngdialog-fadein 0.5s;\" ng-repeat=\"row in msglist\" ng-class=\"{'alert alert-success': row.type == 'S','alert alert-info': row.type == 'N', 'alert alert-warning': row.type=='W', 'alert alert-danger': row.type=='E'}\"><a class=\"close\" style=\"color:#000;\" ng-click=\"remove(row)\">&times;</a><span ng-class=\"{'label label-info': row.type == 'N', 'label label-success': row.type == 'S', 'label label-warning': row.type == 'W', 'label label-danger': row.type == 'E'}\">{{row.label}}</span>&nbsp;{{row.message}}</div></div></div></div></div></div></div>"},controller:["$rootScope","$scope",function(t,n){n.msglist=[],n.getApServerInfo=function(){e.sendRecv("CMFPG000","getApServerInfo","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{}).then(function(t,e){e||(t=t[0].body,i.setApServerName(t.apServerName))})},n.getApServerInfo(),n.remove=function(t,e){if(e)n.msglist=[];else for(var a=0;a<n.msglist.length;a+=1)n.msglist[a]==t&&n.msglist.splice(a,1);0<n.msglist.length||(e=$("#mwt_slider_content").width(),$("#mwt_mwt_slider_scroll").animate({left:"-"+e+"px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-left"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-right"),$("#mwt_fb_tab a").removeClass("left_go"),$("#mwt_fb_tab a").addClass("left_no"))},t.showStatusMsg=function(t,e){if(t){var e=e.toString().toUpperCase().trim(),t=t.toString().trim(),a="",l="";switch(e){case"SUCCESS":a="S",l="成功訊息";break;case"NORMAL":a="N",l="一般訊息";break;case"WARNING":a="W",l="警告訊息";break;case"DANGER":a="E",l="錯誤訊息";break;default:a="N",l="一般訊息"}n.msglist.unshift({type:a,message:(angular.isDefined(i.getApServerName())&&"null"!=i.getApServerName()&&"undefined"!=i.getApServerName()?" ("+i.getApServerName()+") ":"")+t,label:l}),3<=n.msglist.length&&(n.msglist.length=3)}},n.insert=function(t){var e,a,l=$("#mwt_slider_content").width(),s=$("#mwt_msg_panl").children(":nth-child("+(n.msglist.indexOf(t)+1)+")");switch(t.type){case"N":e="rgba(42,176,237,1)",a="hsla(350,99%,55%,0.9)";break;case"S":e="rgba(0,36,0,1)",a="hsla(350,99%,55%,0.9)";break;case"W":e="rgba(237,144,23,1)",a="hsla(350,99%,55%,0.9)";break;case"E":e="rgba(231,56,39,1)",a="rgb(51,51,51)";break;default:e="rgba(42,176,237,1)",a="hsla(350,99%,55%,0.9)"}$("#mwt_fb_tab>a>span>i, #mwt_fb_tab>a>span:not([class*='badge'])").animate({color:"hsla(350,99%,55%,0.9)"},300).animate({color:"#FFF"},300),$("#mwt_fb_tab>a>span.badge").animate({color:"hsla(350,99%,55%,0.9)"},300).animate({color:"#ff8080"},300),$(s).not("#e-msgbar-clear").animate({color:a},300).animate({color:e},300).animate({color:a},300).animate({color:e},300),$("#mwt_mwt_slider_scroll").css("left")=="-"+l+"px"&&($("#mwt_mwt_slider_scroll").animate({left:"0px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-right"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-left"),$("#mwt_fb_tab a").removeClass("left_no"),$("#mwt_fb_tab a").addClass("left_go"),n.$autoclose(!0))}}],link:function(a,t,e,l,s){var n=$("#mwt_slider_content").width();i.Exclude.IP.indexOf(document.location.hostname);a.$autoclose=function(t){var e,a;t?(e=0,a=o(function(){30<=++e&&($("#mwt_mwt_slider_scroll").animate({left:"-"+n+"px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-left"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-right"),$("#mwt_fb_tab a").removeClass("left_go"),$("#mwt_fb_tab a").addClass("left_no"),e=0,o.cancel(a))},1e3)):a&&o.cancel(a)},$("#mwt_fb_tab").attr("title","滑鼠點擊展開或隱藏訊息視窗").on("mouseenter",function(){$("#mwt_fb_tab").addClass("mwt_fb_tab-hover","fast"),$(".mwt_btn_color").animate({color:"hsla(350,99%,55%,0.9)!important"},600)}).on("mouseleave",function(){$("#mwt_fb_tab").removeClass("mwt_fb_tab-hover","fast"),$(".mwt_btn_color").animate({color:"#FFF!important"},600)}),$("#mwt_fb_tab").on("click",function(){a.$autoclose(!1),$("#mwt_mwt_slider_scroll").css("left")=="-"+n+"px"?($("#mwt_mwt_slider_scroll").animate({left:"0px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-right"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-left"),$("#mwt_fb_tab a").removeClass("left_no"),$("#mwt_fb_tab a").addClass("left_go"),a.$autoclose(!0)):($("#mwt_mwt_slider_scroll").animate({left:"-"+n+"px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-left"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-right"),$("#mwt_fb_tab a").removeClass("left_go"),$("#mwt_fb_tab a").addClass("left_no"))}),a.$watch("msglist",function(t,e){0<a.msglist.length||$("#mwt_mwt_slider_scroll").css("left")!="-"+n+"px"&&($("#mwt_mwt_slider_scroll").animate({left:"-"+n+"px"},500,"swing"),$("#mwt_fb_tab i").removeClass("glyphicon-chevron-left"),$("#mwt_fb_tab i").addClass("glyphicon-chevron-right"),$("#mwt_fb_tab a").removeClass("left_go"),$("#mwt_fb_tab a").addClass("left_no"),a.$autoclose(!1))})}}}]);