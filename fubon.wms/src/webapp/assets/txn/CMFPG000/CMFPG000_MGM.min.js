"use strict";eSoafApp.config(["$locationProvider",function(e){e.html5Mode(!0)}]),eSoafApp.controller("CMFPG000Controller",["$rootScope","$scope","$location","sysInfoService","projInfoService","$controller","ngDialog","$cookies","$q","$window","$timeout","getParameter","$filter",function(e,o,r,t,n,s,i,a,l,c,I,u,D){function g(){var e={authuid:o.authuid,iptAppUsername:o.loginID,iptAppUserPassword:o.loginCD,iptRACFUser_ID:"888803",iptRACF_Password:"",ddlBranchNo:o.branchModel,kickOut:!0};o.sendRecv("CMFPG000","authenticate","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",e,function(e,r){if(console.log("MGM-tlron tota="+e+", isError="+r),r)o.msgData=e.body.msgData;else if(e[0].body.loginMsg&&o.showWarningMsg(e[0].body.loginMsg),t.setCurrentUserId(o.loginID),1===e[0].body.userList.length)console.log("#"+o.loginSourceToken),t.setUserList(e[0].body.userList),o.sendRecv("CMFPG000","tlron","com.systex.jbranch.app.server.fps.cmfpg000.LoginPageVO",{iptAppUsername:e[0].body.userList[0].EMP_ID,iptAppUserRole:e[0].body.userList[0].ROLE_ID,iptAppUserDeptID:e[0].body.userList[0].DEPT_ID,iptAppUserRegioinCenterID:e[0].body.userList[0].REGION_CENTER_ID,iptAppUserRegioinCenterName:e[0].body.userList[0].REGION_CENTER_NAME,iptAppUserBranchAreaID:e[0].body.userList[0].BRANCH_AREA_ID,iptAppUserBranchAreaName:e[0].body.userList[0].BRANCH_AREA_NAME,iptAppUserBranchID:e[0].body.userList[0].BRANCH_NBR,iptAppUserBranchName:e[0].body.userList[0].BRANCH_NAME,iptAppUserIsPrimaryRole:e[0].body.userList[0].IS_PRIMARY_ROLE,loginSourceToken:o.loginSourceToken,currentUserId:o.loginID},function(e,r){console.log("MGM-1-tlron tota="+e+", isError="+r),r?o.msgData=e.body.msgData:o.setSysInfoService(e[0].body)});else{if(!(e[0].body.userList.length>1))return;var s=o.loginSourceToken;t.setUserList(e[0].body.userList),i.open({template:"assets/txn/CMFPG000/CMFPG000_AGENT.html",className:"CMFPG000",showClose:!1,controller:["$scope",function(o){o.userList=e[0].body.userList,o.loginSourceToken=s}]}).closePromise.then(function(e){"successful"===e.value&&o.setSysInfoService(n.LoginInfo)})}})}function p(){var e=l.defer();return u.XML("WATERMARK",function(o){o&&(t.setWATERMARK(o.data[0]),e.resolve(t.getWATERMARK()))}),e.promise}function M(e){var r=l.defer();return e&&(e=e.split(","),o.sendRecv("CMFPG000","getAuthorities","com.systex.jbranch.app.server.fps.cmfpg000.AuthoritiesInputVO",{roles:e},function(e,n){var s,i;n&&(o.showErrorMsg(e[0].body.msgData),r.reject()),e.length>0&&(t.setAuthorities((s=e[0].body.authorities,i={MODULEID:{}},angular.forEach(s,function(e,o,r){i.MODULEID[e.MODULEID]={},i.MODULEID[e.MODULEID].ITEMID={}}),angular.forEach(s,function(e,o,r){i.MODULEID[e.MODULEID].ITEMID[e.ITEMID]={},i.MODULEID[e.MODULEID].ITEMID[e.ITEMID].FUNCTIONID={}}),angular.forEach(s,function(e,o,r){i.MODULEID[e.MODULEID].ITEMID[e.ITEMID].FUNCTIONID[e.FUNCTIONID]=!0}),i)),r.resolve(t.getAuthorities()))})),r.promise}function E(){var e=l.defer();return o.sendRecv("CMMGR020","getMENUTree","com.systex.jbranch.app.server.fps.cmmgr020.CMMGR020DataVO",{},function(r,n){n&&(o.showErrorMsg(r[0].body.msgData),e.reject()),r.length>0&&(t.setMenu(function(e){for(var o=[],r=0;r<e.length;r++)d(o,e[r],1);return o}(r[0].body.meunTreeLS)),e.resolve(t.getMenu()))}),e.promise}function d(e,o,r){for(var t={},n=!1,s=0;s<e.length;s++)if(o["LEVEL"+r+"_MENU_ID"]==e[s].MENU_ID){n=!0;break}if(!n)return t.MENU_ID=o["LEVEL"+r+"_MENU_ID"],t.MENU_NAME=o["LEVEL"+r+"_MENU_NAME"],t.MENU_TYPE=o["LEVEL"+r+"_MENU_TYPE"],t.SEQ_NUM=o["LEVEL"+r+"_SEQ_NUM"],"P"==o["LEVEL"+r+"_MENU_TYPE"]?(t.ITEM_ID=o["LEVEL"+r+"_ITEM_ID"],void e.push(t)):(t.SUBITEM=[],e.push(t),void d(t.SUBITEM,o,r+1));d(e.slice(-1).pop().SUBITEM,o,r+1)}var L,f;s("BaseController",{$scope:o}),o.controllerName="CMFPG000Controller",o.initData=function(){o.authuid="",o.loginID="",o.loginCD="",o.wsId="00",o.branchModel="0000",o.mask=!1},o.initData(),o.blurThenTlron=function(e){13==e.keyCode&&(e.target.blur(),o.tlron())},o.wson=function(){for(var e=window.location.search.substring(1).split("&"),r=0;r<e.length;r++){var t=e[r].split("=");"authuid"==t[0]&&(o.authuid=t[1])}o.authuid&&(console.log("query: "+window.location.search),g())},o.tlron=function(){o.Show=!0,e.TlrID=o.loginID,e.BranchID=o.branchModel,e.WsId=o.wsId,g()},sessionStorage.CMFPG000_MOBILE_LOGIN?o.loginSourceToken="mobile":r.search().isMobile&&"mobile"==r.search().isMobile&&(o.loginSourceToken="mobile",sessionStorage.CMFPG000_MOBILE_LOGIN="mobile"),o.setSysInfoService=function(e){a.branchId=e.loginBrh,a.UserId=e.loginID,t.setApServerName(e.apServerName),t.setUserID(e.loginID),t.setUserName(e.loginName),t.setApplicationID(o.ApplicationID),t.setBranchID(e.loginBrh),t.setAreaID(e.loginArea),t.setRegionID(e.loginRegion),t.setBranchName(e.loginBrhName),t.setWsID(o.wsId),t.setRoleID(e.loginRole),t.setPriID(e.priID),t.setRoleName(e.loginRoleName),t.setAvailBranch(e.availBranchList),t.setAvailRegion(e.availRegionList),t.setAvailArea(e.availAreaList),t.setUser(e.userInfo),t.setAoCode(e.userInfo.AoCode),t.setLoginSourceToken(e.loginSourceToken),t.setIsUHRM(e.isUHRM),o.UserID=t.getUserID(),o.ApplicationID=t.getApplicationID(),o.BranchID=t.getBranchID(),o.WsID=t.getWsID(),o.RoleID=t.getRoleID(),l.all([E().then(function(e){o.finMenu=!0}),M(t.getRoleID()).then(function(e){o.finAuthorities=!0}),p().then(function(e){o.finWatermark=!0})]).then(function(){u.XML("MGM.URL",function(e){if(e){var o=e.data[e.key.indexOf("MGM.URL")];if(o&&o.length){var r=o[0].LABEL;r&&(window.open(r.replace("{userId}",a.UserId).replace("{branchId}",a.branchId)),window.close())}}})})},e.ApplicationID=uuid(),L=[{LABEL:"SINGLE",DATA:1},{LABEL:"TOTAL",DATA:10}],f=!!navigator.userAgent.match("Safari"),t.setDialogCounts(L),u.XML("MAX_DIALOG_COUNT",function(e){e&&(L=0!=e.data[0].length?e.data[0]:L,t.setDialogCounts(L))}),t.setNavigator(f),o.wson()}]);